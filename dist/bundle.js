!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.modbox=t():e.modbox=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>LoaderMod});var _modapi__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(791);class LoaderMod extends _modapi__WEBPACK_IMPORTED_MODULE_0__.Vb{constructor(){super(...arguments),this.name="JavaScript Loader",this.description="The default loader for modbox.",this.version="0.0.1",this.namespace="loader-js"}Load(data){return eval(data)}CanLoad(e){return e.endsWith(".js")}}},791:(e,t,o)=>{o.d(t,{Vb:()=>l,Cy:()=>c,M5:()=>d});class r{constructor(){this._callbacks={}}on(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}off(e,t){this._callbacks[e]&&this._callbacks[e].forEach(((o,r)=>{o===t&&this._callbacks[e].splice(r,1)}))}once(e,t){this.on(e,((...o)=>{t(o),this.off(e,arguments.callee)}))}emit(e,...t){this._callbacks[e]&&this._callbacks[e].forEach((e=>e(...t)))}}class i{constructor(e,t,o){this.name=e,this.data=t,this.defaultaction=o,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}run_default(...e){this.defaultPrevented||this.defaultaction(...e)}}var s,n;!function(e){e.deepClone=function e(t){let o=[];for(let r=0;r<t.length;r++){let i=t[r];"object"==typeof i&&(i=n.deepClone(i)),Array.isArray(i)&&(i=e(i)),o.push(i)}return o},e.remove=function(e,t){return t.splice(e,1)}}(s||(s={})),function(e){function t(e){for(let o in e){if("function"==typeof e[o])return!0;if("object"==typeof e[o])return t(e[o])}return!1}e.hasFunctions=t,e.deepClone=function e(o){if(window.structuredClone)return window.structuredClone(o);if(!t(o))return JSON.parse(JSON.stringify(o));let r={};for(let t in o)"object"!=typeof o[t]?Array.isArray(o[t])?r[t]=s.deepClone(o[t]):r[t]=o[t]:r[t]=e(o[t])}}(n||(n={}));let a=window;class l{constructor(){this.name="no name",this.description="no description",this.version="0.0.0",this.namespace="mod"}init(){}}class d extends l{constructor(){super(...arguments),this.name="ModAPI",this.description="A API for rmtrollbox mods",this.version="0.0.1",this.namespace="modapi",this.loaded=[],this.hooks={}}GetMod(e){let t=this.loaded.find((t=>t.namespace===e));if(!t)throw new Error(`Mod with namespace ${e} not found.`);return t}GetModByName(e){return this.loaded.find((t=>t.name===e))}GetMods(){return this.loaded}LoadMod(e){let t=new e;this.loaded.find((e=>e.name===t.name))||(this.loaded.push(t),t.init())}ReplaceMod(e,t){let o=this.loaded.findIndex((t=>t.name===e.name));-1!==o&&(this.loaded[o]=t)}Hook(e){if(this.hooks[e])return this.hooks[e];let t=new r,o=a[e];return a[e]=async function(e,...o){let r=s.deepClone(o);t.emit("before_call",r);let n=new i("hooked_function_call",{funcargs:r},e);t.emit("call",n),await(80,new Promise((e=>setTimeout(e,80)))),n.run_default(...r),t.emit("after_call")}.bind(this,o),this.hooks[e]=t,t}FilterMods(e){return this.loaded.filter((t=>t.namespace.startsWith(e)))}}const c=new d}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Mod:()=>e.Vb,ModAPI:()=>e.Cy,ModAPI_C:()=>e.M5});var e=__webpack_require__(791);class t extends e.Vb{constructor(){super(...arguments),this.name="MBLogger",this.description="The default logger for modbox.",this.version="0.0.1",this.namespace="mblogger"}init(){}CreateLogger(e){return new o(e)}}class o{constructor(e){this.name=e}getTime(){let e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`}log(...e){console.log(`[${this.getTime()}] [${this.name}]`,...e)}info(...e){console.info(`[${this.getTime()}] [${this.name}] [INFO]`,...e)}warn(...e){console.warn(`[${this.getTime()}] [${this.name}] [WARN]`,...e)}error(...e){console.error(`[${this.getTime()}] [${this.name}] [ERROR]`,...e)}}class r extends e.Vb{constructor(){super(...arguments),this.name="rmtrollbox",this.description="rmtrollbox API",this.version="0.0.1",this.namespace="rmtrollbox",this.logger=e.Cy.GetMod("mblogger").CreateLogger("rmtrollbox"),this.registeredCommands=[]}init(){this.logger.log("Initializing rmtrollbox API"),e.Cy.Hook("sendMsg").on("call",(e=>{let t=e.data.funcargs[0];if(t.startsWith("/")){let o=t.substr(1).split(" "),r=o.shift(),i="";r.includes(":")&&(i=r.split(":")[0],r=r.split(":")[1]);let s=this.registeredCommands.filter((e=>i?e.namespace===i&&(e.name===r||e.aliases.includes(r)):e.name==r||e.aliases.includes(r)));s.length>0&&(e.preventDefault(),s[0].execute(o))}})),this.logger.info("rmtrollbox api initialized")}PrintMessage(e){window.printMsg(e)}RegisterCommand(e){this.registeredCommands.push(e)}GetElement(e){return document.querySelector(`#trollbox > ${e.GetSelector()}`)}}class i{constructor(e,t){this.name=e,this.element=t,this._children=[]}GetSelector(){return this.element}SetChildren(e){return this._children=e.map((e=>(e.element=`${this.element} > ${e.element}`,e))),this}Get(e){let t=this._children.find((t=>t.name===e));if(!t)throw new Error(`No child named ${e}`);return t}get children(){return Object.fromEntries(this._children.map((e=>[e.name,e])))}}new i("Form","#trollbox_form").SetChildren([new i("Input","textarea#trollbox_input"),new i("SendButton","button"),new i("NickButton","button#trollbox_nick_btn"),new i("UploadButton","button#trollbox_upload_btn")]);class s extends e.Vb{constructor(){super(...arguments),this.name="ModStorage",this.description="A mod that stores mod data",this.version="0.0.1",this.namespace="storage"}init(){}GetStorage(e){return new n(e)}}class n{constructor(e){this.name=e}Get(e){return localStorage.getItem(`${this.name}/${e}`)}Set(e,t){localStorage.setItem(`${this.name}/${e}`,t)}Remove(e){localStorage.removeItem(`${this.name}/${e}`)}List(){let e=Object.keys(localStorage),t=[];for(let o=0;o<e.length;o++)e[o].startsWith(this.name+"/")&&t.push(e[o].replace(`${this.name}/`,""));return t}Clear(){this.List().forEach((e=>{this.Remove(e)}))}}var a=__webpack_require__(462);class l extends e.Vb{constructor(){super(...arguments),this.name="Mod Loader",this.description="A mod that loads mods",this.version="0.0.1",this.namespace="modloader",this.logger=e.Cy.GetMod("mblogger").CreateLogger("modloader")}init(){this.logger.info("Loading mods...");let t=e.Cy.GetMod("storage").GetStorage("mods"),o=t.List(),r=o.map((e=>t.Get(e))),i=[];r.forEach(((e,t)=>{e.startsWith("//@modloader-priority")&&i.push(t)})),this.logger.info(`Found ${t.List().length} mods`);for(let t of i)this.logger.info(`Loading prioritized mod ${o[t]}`),e.Cy.LoadMod(o[t]),o.splice(t,1);for(let o=0;o<t.List().length;o++){let r=t.Get(t.List()[o]);this.logger.info(`Loading ${r}`);let i=e.Cy.FilterMods("loader-"),s=!1;for(let t of i)if(t.CanLoad(r)){this.logger.info(`Loading mod ${r} with loader ${t.name}`),e.Cy.LoadMod(t.Load(r)),this.logger.info(`Loaded ${r}`),s=!0;break}s||this.logger.error(`Could not load mod ${r}: no loader found for it`)}this.logger.info(`${e.Cy.GetMods().length} Mods loaded`)}}e.Cy.LoadMod(t),e.Cy.LoadMod(r),e.Cy.LoadMod(s),e.Cy.LoadMod(a.Z),e.Cy.LoadMod(l)})(),__webpack_exports__})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SEEsR0FDRDlDLEtBQUtpSCxPQUFPRixNQUFNLHNCQUFzQnhELDZCQUdoRHZELEtBQUtpSCxPQUFPSixLQUFLLEdBQUcsZUFBaUJoRix1QkFHN0MsYUFBZW9FLEdBQ2YsYUFBZWUsR0FDZixhQUFlK0IsR0FDZixhQUFlLEtBQ2YsYUFBZWMsSSIsInNvdXJjZXMiOlsid2VicGFjazovL21vZGJveC93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL2xvYWRlci1qcy50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvZXZlbnRzLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy91dGlsLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9tb2RhcGkudHMiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21vZGJveC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL21ibG9nZ2VyLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9ybXRyb2xsYm94LnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9tb2RzdG9yYWdlLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJtb2Rib3hcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wibW9kYm94XCJdID0gZmFjdG9yeSgpO1xufSkoc2VsZiwgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiaW1wb3J0IHsgTW9kIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvYWRlck1vZCBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJKYXZhU2NyaXB0IExvYWRlclwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlRoZSBkZWZhdWx0IGxvYWRlciBmb3IgbW9kYm94LlwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibG9hZGVyLWpzXCI7XHJcbiAgICBMb2FkKGRhdGE6IHN0cmluZyk6IE1vZCB7XHJcbiAgICAgICAgcmV0dXJuIGV2YWwoZGF0YSkgYXMgTW9kO1xyXG4gICAgfVxyXG4gICAgQ2FuTG9hZChmaWxlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZmlsZS5lbmRzV2l0aChcIi5qc1wiKTtcclxuICAgIH1cclxufSIsImludGVyZmFjZSBjYWxsYmFja2R1YyB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBGdW5jdGlvbltdO1xyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50RW1pdHRlciB7XHJcbiAgICBwdWJsaWMgX2NhbGxiYWNrczogY2FsbGJhY2tkdWM7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSB7fTtcclxuICAgIH1cclxuICAgIG9uKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdKSB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spO1xyXG4gICAgfVxyXG4gICAgb2ZmKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0uZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gY2FsbGJhY2spIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIG9uY2UoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIHRoaXMub24oZXZlbnROYW1lLCAoLi4uZDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZCk7XHJcbiAgICAgICAgICAgIHRoaXMub2ZmKGV2ZW50TmFtZSwgYXJndW1lbnRzLmNhbGxlZSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIGVtaXQoZXZlbnROYW1lOiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLmZvckVhY2goeCA9PiB4KC4uLmFyZ3MpKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgRXZlbnQge1xyXG4gICAgcHVibGljIGRlZmF1bHRQcmV2ZW50ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsIHB1YmxpYyBkYXRhOiBhbnksIHB1YmxpYyBkZWZhdWx0YWN0aW9uOiBGdW5jdGlvbikge307XHJcbiAgICBwcmV2ZW50RGVmYXVsdCgpIHtcclxuICAgICAgICB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgcnVuX2RlZmF1bHQoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdFByZXZlbnRlZCkgdGhpcy5kZWZhdWx0YWN0aW9uKC4uLmFyZ3MpO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpIHtyZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSl9O1xyXG5leHBvcnQgbmFtZXNwYWNlIGFycmF5IHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBkZWVwQ2xvbmUoYXJyOiBhbnlbXSk6IGFueVtdIHtcclxuICAgICAgICBsZXQgbmV3YXJyOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gYXJyW2ldO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIpIGRhdGEgPSBvYmplY3QuZGVlcENsb25lKGRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgZGF0YSA9IGRlZXBDbG9uZShkYXRhKTtcclxuICAgICAgICAgICAgbmV3YXJyLnB1c2goZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXdhcnI7XHJcbiAgICB9O1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZShpbmRleDogbnVtYmVyLCBhcnI6IGFueVtdKXtcclxuICAgICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IG5hbWVzcGFjZSBvYmplY3Qge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGhhc0Z1bmN0aW9ucyhvYmo6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGZvciAobGV0IGl0ZW0gaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2l0ZW1dID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9ialtpdGVtXSA9PT0gXCJvYmplY3RcIikgcmV0dXJuIGhhc0Z1bmN0aW9ucyhvYmpbaXRlbV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVlcENsb25lKG9iajogYW55KTogYW55IHtcclxuICAgICAgICBpZiAoKHdpbmRvdyBhcyBhbnkpLnN0cnVjdHVyZWRDbG9uZSkgcmV0dXJuICh3aW5kb3cgYXMgYW55KS5zdHJ1Y3R1cmVkQ2xvbmUob2JqKVxyXG4gICAgICAgIGlmICghaGFzRnVuY3Rpb25zKG9iaikpIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xyXG4gICAgICAgIGxldCBuZXdvYmo6IGFueSA9IHt9O1xyXG4gICAgICAgIGZvciAobGV0IGl0ZW0gaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2l0ZW1dID09PSBcIm9iamVjdFwiKSB7bmV3b2JqW2l0ZW1dID0gZGVlcENsb25lKG9ialtpdGVtXSk7IGNvbnRpbnVlfVxyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmpbaXRlbV0pKSB7bmV3b2JqW2l0ZW1dID0gYXJyYXkuZGVlcENsb25lKG9ialtpdGVtXSk7IGNvbnRpbnVlfVxyXG4gICAgICAgICAgICBuZXdvYmpbaXRlbV0gPSBvYmpbaXRlbV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IEV2ZW50RW1pdHRlciwgeyBFdmVudCB9IGZyb20gXCIuL2V2ZW50c1wiO1xyXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vdXRpbCc7XHJcbmxldCB3aW5vID0gd2luZG93IGFzIGFueTtcclxuXHJcbmV4cG9ydCBjbGFzcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwibm8gbmFtZVwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIm5vIGRlc2NyaXB0aW9uXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMFwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtb2RcIjtcclxuICAgIGluaXQoKSB7fVxyXG59XHJcbmV4cG9ydCBjbGFzcyBNb2RBUElfQyBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNb2RBUElcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJBIEFQSSBmb3Igcm10cm9sbGJveCBtb2RzXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtb2RhcGlcIjtcclxuICAgIHByaXZhdGUgbG9hZGVkOiBNb2RbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBob29rczoge1trZXk6IHN0cmluZ106IEV2ZW50RW1pdHRlcn0gPSB7fTtcclxuICAgIHB1YmxpYyBHZXRNb2Q8VD4obmFtZXNwYWNlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYSA9IHRoaXMubG9hZGVkLmZpbmQoeCA9PiB4Lm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlKTtcclxuICAgICAgICBpZiAoIWEpIHRocm93IG5ldyBFcnJvcihgTW9kIHdpdGggbmFtZXNwYWNlICR7bmFtZXNwYWNlfSBub3QgZm91bmQuYCk7XHJcbiAgICAgICAgcmV0dXJuIGEgYXMgdW5rbm93biBhcyBUO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldE1vZEJ5TmFtZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZWQuZmluZCh4ID0+IHgubmFtZSA9PT0gbmFtZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgR2V0TW9kcygpOiBNb2RbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkO1xyXG4gICAgfVxyXG4gICAgcHVibGljIExvYWRNb2QobW9kOiBhbnkpIHtcclxuICAgICAgICBsZXQgbG1vZDogTW9kID0gbmV3IG1vZCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWRlZC5maW5kKHggPT4geC5uYW1lID09PSBsbW9kLm5hbWUpKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5sb2FkZWQucHVzaChsbW9kKTtcclxuICAgICAgICBsbW9kLmluaXQoKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZXBsYWNlTW9kKG1vZDogTW9kLCBuZXdtb2Q6IE1vZCkge1xyXG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMubG9hZGVkLmZpbmRJbmRleCh4ID0+IHgubmFtZSA9PT0gbW9kLm5hbWUpO1xyXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHJldHVybjtcclxuICAgICAgICB0aGlzLmxvYWRlZFtpbmRleF0gPSBuZXdtb2Q7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgSG9vayhmdW5jdGlvbl9uYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAodGhpcy5ob29rc1tmdW5jdGlvbl9uYW1lXSkgcmV0dXJuIHRoaXMuaG9va3NbZnVuY3Rpb25fbmFtZV07XHJcbiAgICAgICAgbGV0IGV2ZW0gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgbGV0IG9nZnVuYyA9IHdpbm9bZnVuY3Rpb25fbmFtZV07XHJcbiAgICAgICAgd2lub1tmdW5jdGlvbl9uYW1lXSA9IChhc3luYyBmdW5jdGlvbiAob2dmdW5jOiBGdW5jdGlvbiwgLi4uZmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgICAgIGxldCBuYXJncyA9IHV0aWwuYXJyYXkuZGVlcENsb25lKGZhcmdzKTtcclxuICAgICAgICAgICAgZXZlbS5lbWl0KCdiZWZvcmVfY2FsbCcsIG5hcmdzKTsgLy8geW91IGNhbiB1c2UgYmVmb3JlIGNhbGwgdG8gcXVpY2tseSBtb2RpZnkgdGhlIGFyZ3VtZW50c1xyXG4gICAgICAgICAgICBsZXQgZmV2ZW50ID0gbmV3IEV2ZW50KCdob29rZWRfZnVuY3Rpb25fY2FsbCcsIHtmdW5jYXJnczogbmFyZ3N9LCBvZ2Z1bmMpO1xyXG4gICAgICAgICAgICBldmVtLmVtaXQoJ2NhbGwnLGZldmVudCk7XHJcbiAgICAgICAgICAgIGF3YWl0IHV0aWwuc2xlZXAoODApO1xyXG4gICAgICAgICAgICBmZXZlbnQucnVuX2RlZmF1bHQoLi4ubmFyZ3MpO1xyXG4gICAgICAgICAgICBldmVtLmVtaXQoXCJhZnRlcl9jYWxsXCIpO1xyXG4gICAgICAgIH0pLmJpbmQodGhpcywgb2dmdW5jKTtcclxuICAgICAgICB0aGlzLmhvb2tzW2Z1bmN0aW9uX25hbWVdID0gZXZlbTtcclxuICAgICAgICByZXR1cm4gZXZlbTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBGaWx0ZXJNb2RzPFQ+KHByZWZpeDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkLmZpbHRlcih4ID0+IHgubmFtZXNwYWNlLnN0YXJ0c1dpdGgocHJlZml4KSkgYXMgdW5rbm93biBhcyBUW107XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNvbnN0IE1vZEFQSSA9IG5ldyBNb2RBUElfQygpOyIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgTW9kIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1CTG9nZ2VyIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1CTG9nZ2VyXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiVGhlIGRlZmF1bHQgbG9nZ2VyIGZvciBtb2Rib3guXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtYmxvZ2dlclwiO1xyXG4gICAgcHVibGljIGluaXQoKSB7fVxyXG4gICAgcHVibGljIENyZWF0ZUxvZ2dlcihuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IExvZ2dlcihuYW1lKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgTG9nZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcpIHt9XHJcbiAgICBwcml2YXRlIGdldFRpbWUoKSB7XHJcbiAgICAgICAgbGV0IGQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGxldCBob3VyID0gZC5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xyXG4gICAgICAgIGxldCBtaW51dGUgPSBkLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuICAgICAgICBsZXQgc2Vjb25kID0gZC5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgICAgICAgcmV0dXJuIGAke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH1gO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGxvZyguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgaW5mbyguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XSBbSU5GT11gLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyB3YXJuKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dIFtXQVJOXWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGVycm9yKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XSBbRVJST1JdYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBNb2QsIE1vZEFQSSB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5pbXBvcnQgTUJMb2dnZXIgZnJvbSBcIi4vbWJsb2dnZXJcIjtcclxuaW1wb3J0IEV2ZW50RW1pdHRlciwge0V2ZW50fSBmcm9tIFwiLi9ldmVudHNcIjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2Ugcm1NZXNzYWdlIHtcclxuICAgIG5pY2s6IHN0cmluZztcclxuICAgIGhvbWU6IHN0cmluZztcclxuICAgIG1zZzogc3RyaW5nO1xyXG4gICAgZGF0ZTogbnVtYmVyO1xyXG4gICAgY29sb3I6IHN0cmluZztcclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIENvbW1hbmQge1xyXG4gICAgbmFtZXNwYWNlOiBzdHJpbmc7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xyXG4gICAgdXNhZ2U6IHN0cmluZztcclxuICAgIGFsaWFzZXM6IHN0cmluZ1tdO1xyXG4gICAgZXhlY3V0ZTogKGFyZ3M6IHN0cmluZ1tdKSA9PiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBybXRyb2xsYm94IGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcInJtdHJvbGxib3hcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJybXRyb2xsYm94IEFQSVwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwicm10cm9sbGJveFwiO1xyXG4gICAgcHVibGljIGxvZ2dlciA9IE1vZEFQSS5HZXRNb2Q8TUJMb2dnZXI+KFwibWJsb2dnZXJcIikuQ3JlYXRlTG9nZ2VyKFwicm10cm9sbGJveFwiKTtcclxuICAgIHByaXZhdGUgcmVnaXN0ZXJlZENvbW1hbmRzOiBDb21tYW5kW10gPSBbXTtcclxuICAgIHB1YmxpYyBpbml0KCkge1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhcIkluaXRpYWxpemluZyBybXRyb2xsYm94IEFQSVwiKTtcclxuICAgICAgICBsZXQgc25kTXNnSG9vayA9IE1vZEFQSS5Ib29rKFwic2VuZE1zZ1wiKTtcclxuICAgICAgICBzbmRNc2dIb29rLm9uKFwiY2FsbFwiLCAoZXY6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtc2cgPSBldi5kYXRhLmZ1bmNhcmdzWzBdO1xyXG4gICAgICAgICAgICBpZiAobXNnLnN0YXJ0c1dpdGgoJy8nKSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBtc2cuc3Vic3RyKDEpLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgY21kID0gYXJncy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5hbWVzcGFjZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21kLmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2UgPSBjbWQuc3BsaXQoJzonKVswXTtcclxuICAgICAgICAgICAgICAgICAgICBjbWQgPSBjbWQuc3BsaXQoJzonKVsxXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCBjbWRzID0gdGhpcy5yZWdpc3RlcmVkQ29tbWFuZHMuZmlsdGVyKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMubmFtZXNwYWNlID09PSBuYW1lc3BhY2UgJiYgKGMubmFtZSA9PT0gY21kIHx8IGMuYWxpYXNlcy5pbmNsdWRlcyhjbWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLm5hbWUgPT0gY21kIHx8IGMuYWxpYXNlcy5pbmNsdWRlcyhjbWQpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21kcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBjbWRzWzBdLmV4ZWN1dGUoYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJybXRyb2xsYm94IGFwaSBpbml0aWFsaXplZFwiKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBQcmludE1lc3NhZ2UobXNnOiBybU1lc3NhZ2UpIHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICB3aW5kb3cucHJpbnRNc2cobXNnKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZWdpc3RlckNvbW1hbmQoY21kOiBDb21tYW5kKSB7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkQ29tbWFuZHMucHVzaChjbWQpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldEVsZW1lbnQodWllbGVtZW50OiBVSUVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ryb2xsYm94ID4gJHt1aWVsZW1lbnQuR2V0U2VsZWN0b3IoKX1gKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBVSUVsZW1lbnQge1xyXG4gICAgcHJpdmF0ZSBfY2hpbGRyZW46IFVJRWxlbWVudFtdID0gW107XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCBwdWJsaWMgZWxlbWVudDogc3RyaW5nKSB7fVxyXG4gICAgcHVibGljIEdldFNlbGVjdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgU2V0Q2hpbGRyZW4oY2hpbGRzOiBVSUVsZW1lbnRbXSkge1xyXG4gICAgICAgIHRoaXMuX2NoaWxkcmVuID0gY2hpbGRzLm1hcCh4ID0+IHtcclxuICAgICAgICAgICAgeC5lbGVtZW50ID0gYCR7dGhpcy5lbGVtZW50fSA+ICR7eC5lbGVtZW50fWA7XHJcbiAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldChuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYSA9IHRoaXMuX2NoaWxkcmVuLmZpbmQoeCA9PiB4Lm5hbWUgPT09IG5hbWUpO1xyXG4gICAgICAgIGlmICghYSkgdGhyb3cgbmV3IEVycm9yKGBObyBjaGlsZCBuYW1lZCAke25hbWV9YCk7XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICB9XHJcbiAgICBnZXQgY2hpbGRyZW4oKToge1trZXk6IHN0cmluZ106IFVJRWxlbWVudH0ge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5fY2hpbGRyZW4ubWFwKHggPT4gW3gubmFtZSwgeF0pKVxyXG4gICAgfVxyXG59XHJcbi8qZXhwb3J0IGNvbnN0IFVJID0ge1xyXG4gICAgRm9ybToge1xyXG4gICAgICAgIF9fY29tYmluZTogXCIjdHJvbGxib3hfZm9ybVwiLFxyXG4gICAgICAgIGdldCBJbnB1dCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX19jb21iaW5lfSA+IHRleHRhcmVhI3Ryb2xsYm94X2lucHV0YDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBTZW5kQnV0dG9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gYnV0dG9uYDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBOaWNrQnV0dG9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gYnV0dG9uI3Ryb2xsYm94X25pY2tfYnRuYDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBVcGxvYWRCdXR0b24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9fY29tYmluZX0gPiBidXR0b24jdHJvbGxib3hfdXBsb2FkX2J0bmA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Ki9cclxuZXhwb3J0IGNvbnN0IFVJID0ge1xyXG4gICAgRm9ybTogbmV3IFVJRWxlbWVudChcIkZvcm1cIiwgXCIjdHJvbGxib3hfZm9ybVwiKS5TZXRDaGlsZHJlbihbXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIklucHV0XCIsIFwidGV4dGFyZWEjdHJvbGxib3hfaW5wdXRcIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIlNlbmRCdXR0b25cIiwgXCJidXR0b25cIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIk5pY2tCdXR0b25cIiwgXCJidXR0b24jdHJvbGxib3hfbmlja19idG5cIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIlVwbG9hZEJ1dHRvblwiLCBcImJ1dHRvbiN0cm9sbGJveF91cGxvYWRfYnRuXCIpXHJcblxyXG4gICAgXSlcclxufVxyXG4iLCJpbXBvcnQgeyBNb2QgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kU3RvcmFnZSBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNb2RTdG9yYWdlXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiQSBtb2QgdGhhdCBzdG9yZXMgbW9kIGRhdGFcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcInN0b3JhZ2VcIjtcclxuICAgIHB1YmxpYyBpbml0KCkge31cclxuICAgIHB1YmxpYyBHZXRTdG9yYWdlKG5hbWU6IHN0cmluZyk6IFN0b3JhZ2VEYXRhIHtcclxuICAgICAgICByZXR1cm4gbmV3IFN0b3JhZ2VEYXRhKG5hbWUpO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIFN0b3JhZ2VEYXRhIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcpIHt9XHJcbiAgICBwdWJsaWMgR2V0KGtleTogc3RyaW5nKTogYW55IHtcclxuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYCR7dGhpcy5uYW1lfS8ke2tleX1gKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBTZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHt0aGlzLm5hbWV9LyR7a2V5fWAsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZW1vdmUoa2V5OiBzdHJpbmcpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgJHt0aGlzLm5hbWV9LyR7a2V5fWApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIExpc3QoKSB7XHJcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xyXG4gICAgICAgIGxldCBtb2RzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlzW2ldLnN0YXJ0c1dpdGgodGhpcy5uYW1lK1wiL1wiKSkge1xyXG4gICAgICAgICAgICAgICAgbW9kcy5wdXNoKGtleXNbaV0ucmVwbGFjZShgJHt0aGlzLm5hbWV9L2AsIFwiXCIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbW9kcztcclxuICAgIH1cclxuICAgIHB1YmxpYyBDbGVhcigpIHtcclxuICAgICAgICB0aGlzLkxpc3QoKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuUmVtb3ZlKGtleSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBNb2RBUEksIE1vZCwgTW9kQVBJX0MgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuaW1wb3J0IE1CTG9nZ2VyIGZyb20gXCIuL21ibG9nZ2VyXCI7XHJcbmltcG9ydCBybXRyb2xsYm94IGZyb20gXCIuL3JtdHJvbGxib3hcIjtcclxuaW1wb3J0IE1vZFN0b3JhZ2UgZnJvbSBcIi4vbW9kc3RvcmFnZVwiO1xyXG5pbXBvcnQgTG9hZGVyTW9kIGZyb20gXCIuL2xvYWRlci1qc1wiO1xyXG5cclxuY2xhc3MgTW9kTG9hZGVyIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1vZCBMb2FkZXJcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJBIG1vZCB0aGF0IGxvYWRzIG1vZHNcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIm1vZGxvYWRlclwiO1xyXG4gICAgcHJpdmF0ZSBsb2dnZXIgPSBNb2RBUEkuR2V0TW9kPE1CTG9nZ2VyPihcIm1ibG9nZ2VyXCIpLkNyZWF0ZUxvZ2dlcihcIm1vZGxvYWRlclwiKTtcclxuICAgIHB1YmxpYyBpbml0KCkge1xyXG4gICAgICAgIC8qLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93Lk1vZEFQSSA9IE1vZEFQSTsgLy8gZXhwb3NlIHRoZSBNb2RBUEkgdG8gdGhlIHdpbmRvd1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ01vZEFQSSBleHBvc2VkIHRvIHdpbmRvdycpO1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIHdpbmRvdy5Nb2QgPSBNb2Q7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnTW9kIGNsYXNzIGV4cG9zZWQgdG8gd2luZG93Jyk7Ki9cclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdMb2FkaW5nIG1vZHMuLi4nKTtcclxuICAgICAgICBsZXQgbW9kcyA9IE1vZEFQSS5HZXRNb2Q8TW9kU3RvcmFnZT4oXCJzdG9yYWdlXCIpLkdldFN0b3JhZ2UoXCJtb2RzXCIpXHJcbiAgICAgICAgbGV0IG1vZExpc3QgPSBtb2RzLkxpc3QoKTtcclxuICAgICAgICBsZXQgbW9kVGV4dCA9IG1vZExpc3QubWFwKHggPT4gbW9kcy5HZXQoeCkpO1xyXG4gICAgICAgIGxldCBwcmlvcml0eU1vZHM6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgbW9kVGV4dC5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJy8vQG1vZGxvYWRlci1wcmlvcml0eScpKSB7XHJcbiAgICAgICAgICAgICAgICBwcmlvcml0eU1vZHMucHVzaChpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYEZvdW5kICR7bW9kcy5MaXN0KCkubGVuZ3RofSBtb2RzYCk7XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggb2YgcHJpb3JpdHlNb2RzKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYExvYWRpbmcgcHJpb3JpdGl6ZWQgbW9kICR7bW9kTGlzdFtpbmRleF19YCk7XHJcbiAgICAgICAgICAgIE1vZEFQSS5Mb2FkTW9kKG1vZExpc3RbaW5kZXhdKTtcclxuICAgICAgICAgICAgbW9kTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vZHMuTGlzdCgpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBtb2QgPSBtb2RzLkdldChtb2RzLkxpc3QoKVtpXSlcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGluZyAke21vZH1gKTtcclxuICAgICAgICAgICAgbGV0IGxvYWRlcnMgPSBNb2RBUEkuRmlsdGVyTW9kczxMb2FkZXJNb2Q+KFwibG9hZGVyLVwiKTtcclxuICAgICAgICAgICAgbGV0IGxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBsb2FkZXIgb2YgbG9hZGVycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvYWRlci5DYW5Mb2FkKG1vZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBMb2FkaW5nIG1vZCAke21vZH0gd2l0aCBsb2FkZXIgJHtsb2FkZXIubmFtZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICBNb2RBUEkuTG9hZE1vZChsb2FkZXIuTG9hZChtb2QpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBMb2FkZWQgJHttb2R9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWxvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYENvdWxkIG5vdCBsb2FkIG1vZCAke21vZH06IG5vIGxvYWRlciBmb3VuZCBmb3IgaXRgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGAke01vZEFQSS5HZXRNb2RzKCkubGVuZ3RofSBNb2RzIGxvYWRlZGApO1xyXG4gICAgfVxyXG59XHJcbk1vZEFQSS5Mb2FkTW9kKE1CTG9nZ2VyKTtcclxuTW9kQVBJLkxvYWRNb2Qocm10cm9sbGJveCk7XHJcbk1vZEFQSS5Mb2FkTW9kKE1vZFN0b3JhZ2UpO1xyXG5Nb2RBUEkuTG9hZE1vZChMb2FkZXJNb2QpO1xyXG5Nb2RBUEkuTG9hZE1vZChNb2RMb2FkZXIpO1xyXG5cclxuZXhwb3J0IHsgTW9kLCBNb2RBUEksIE1vZEFQSV9DIH07Il0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJMb2FkZXJNb2QiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJ2ZXJzaW9uIiwibmFtZXNwYWNlIiwiTG9hZCIsImRhdGEiLCJldmFsIiwiQ2FuTG9hZCIsImZpbGUiLCJlbmRzV2l0aCIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidGhpcyIsIl9jYWxsYmFja3MiLCJvbiIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwicHVzaCIsIm9mZiIsImZvckVhY2giLCJ2YWx1ZSIsImluZGV4Iiwic3BsaWNlIiwib25jZSIsImQiLCJhcmd1bWVudHMiLCJjYWxsZWUiLCJlbWl0IiwiYXJncyIsIngiLCJFdmVudCIsImRlZmF1bHRhY3Rpb24iLCJkZWZhdWx0UHJldmVudGVkIiwicHJldmVudERlZmF1bHQiLCJydW5fZGVmYXVsdCIsImFycmF5Iiwib2JqZWN0IiwiZGVlcENsb25lIiwiYXJyIiwibmV3YXJyIiwiaSIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsInJlbW92ZSIsImhhc0Z1bmN0aW9ucyIsIm9iaiIsIml0ZW0iLCJ3aW5kb3ciLCJzdHJ1Y3R1cmVkQ2xvbmUiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJuZXdvYmoiLCJ3aW5vIiwiTW9kIiwiaW5pdCIsIk1vZEFQSV9DIiwibG9hZGVkIiwiaG9va3MiLCJHZXRNb2QiLCJhIiwiZmluZCIsIkVycm9yIiwiR2V0TW9kQnlOYW1lIiwiR2V0TW9kcyIsIkxvYWRNb2QiLCJtb2QiLCJsbW9kIiwiUmVwbGFjZU1vZCIsIm5ld21vZCIsImZpbmRJbmRleCIsIkhvb2siLCJmdW5jdGlvbl9uYW1lIiwiZXZlbSIsIm9nZnVuYyIsImZhcmdzIiwibmFyZ3MiLCJmZXZlbnQiLCJmdW5jYXJncyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImJpbmQiLCJGaWx0ZXJNb2RzIiwicHJlZml4IiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsIk1vZEFQSSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJNQkxvZ2dlciIsIkNyZWF0ZUxvZ2dlciIsIkxvZ2dlciIsImdldFRpbWUiLCJEYXRlIiwiZ2V0SG91cnMiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJsb2ciLCJjb25zb2xlIiwiaW5mbyIsIndhcm4iLCJlcnJvciIsInJtdHJvbGxib3giLCJsb2dnZXIiLCJyZWdpc3RlcmVkQ29tbWFuZHMiLCJldiIsIm1zZyIsInN1YnN0ciIsInNwbGl0IiwiY21kIiwic2hpZnQiLCJpbmNsdWRlcyIsImNtZHMiLCJjIiwiYWxpYXNlcyIsImV4ZWN1dGUiLCJQcmludE1lc3NhZ2UiLCJwcmludE1zZyIsIlJlZ2lzdGVyQ29tbWFuZCIsIkdldEVsZW1lbnQiLCJ1aWVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJHZXRTZWxlY3RvciIsIlVJRWxlbWVudCIsImVsZW1lbnQiLCJfY2hpbGRyZW4iLCJTZXRDaGlsZHJlbiIsImNoaWxkcyIsIm1hcCIsIkdldCIsImNoaWxkcmVuIiwiZnJvbUVudHJpZXMiLCJNb2RTdG9yYWdlIiwiR2V0U3RvcmFnZSIsIlN0b3JhZ2VEYXRhIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIlNldCIsInNldEl0ZW0iLCJSZW1vdmUiLCJyZW1vdmVJdGVtIiwiTGlzdCIsImtleXMiLCJtb2RzIiwicmVwbGFjZSIsIkNsZWFyIiwiTW9kTG9hZGVyIiwibW9kTGlzdCIsIm1vZFRleHQiLCJwcmlvcml0eU1vZHMiLCJsb2FkZXJzIiwibG9hZGVyIl0sInNvdXJjZVJvb3QiOiIifQ==