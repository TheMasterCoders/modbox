!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.modbox=t():e.modbox=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>LoaderMod});var _modapi__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(791);class LoaderMod extends _modapi__WEBPACK_IMPORTED_MODULE_0__.Vb{constructor(){super(...arguments),this.name="JavaScript Loader",this.description="The default loader for modbox.",this.version="0.0.1",this.namespace="loader-js"}Load(data){return eval(`(function(){return ${data}})();`)}CanLoad(e){return e.endsWith(".js")}}},791:(e,t,o)=>{o.d(t,{Vb:()=>l,Cy:()=>c,M5:()=>d});class r{constructor(){this._callbacks={}}on(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}off(e,t){this._callbacks[e]&&this._callbacks[e].forEach(((o,r)=>{o===t&&this._callbacks[e].splice(r,1)}))}once(e,t){this.on(e,((...o)=>{t(o),this.off(e,arguments.callee)}))}emit(e,...t){this._callbacks[e]&&this._callbacks[e].forEach((e=>e(...t)))}}class i{constructor(e,t,o){this.name=e,this.data=t,this.defaultaction=o,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}run_default(...e){this.defaultPrevented||this.defaultaction(...e)}}var n,s;!function(e){e.deepClone=function e(t){let o=[];for(let r=0;r<t.length;r++){let i=t[r];"object"==typeof i&&(i=s.deepClone(i)),Array.isArray(i)&&(i=e(i)),o.push(i)}return o},e.remove=function(e,t){return t.splice(e,1)}}(n||(n={})),function(e){function t(e){for(let o in e){if("function"==typeof e[o])return!0;if("object"==typeof e[o])return t(e[o])}return!1}e.hasFunctions=t,e.deepClone=function e(o){if(window.structuredClone)return window.structuredClone(o);if(!t(o))return JSON.parse(JSON.stringify(o));let r={};for(let t in o)"object"!=typeof o[t]?Array.isArray(o[t])?r[t]=n.deepClone(o[t]):r[t]=o[t]:r[t]=e(o[t])}}(s||(s={}));let a=window;class l{constructor(){this.name="no name",this.description="no description",this.version="0.0.0",this.namespace="mod"}init(){}}class d extends l{constructor(){super(...arguments),this.name="ModAPI",this.description="A API for rmtrollbox mods",this.version="0.0.1",this.namespace="modapi",this.loaded=[],this.hooks={}}GetMod(e){let t=this.loaded.find((t=>t.namespace===e));if(!t)throw new Error(`Mod with namespace ${e} not found.`);return t}GetModByName(e){return this.loaded.find((t=>t.name===e))}GetMods(){return this.loaded}LoadMod(e){let t=new e;this.loaded.find((e=>e.name===t.name))||(this.loaded.push(t),t.init())}ReplaceMod(e,t){let o=this.loaded.findIndex((t=>t.name===e.name));-1!==o&&(this.loaded[o]=t)}Hook(e){if(this.hooks[e])return this.hooks[e];let t=new r,o=a[e];return a[e]=async function(e,...o){let r=n.deepClone(o);t.emit("before_call",r);let s=new i("hooked_function_call",{funcargs:r},e);t.emit("call",s),await(80,new Promise((e=>setTimeout(e,80)))),s.run_default(...r),t.emit("after_call")}.bind(this,o),this.hooks[e]=t,t}FilterMods(e){return this.loaded.filter((t=>t.namespace.startsWith(e)))}}const c=new d}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Mod:()=>e.Vb,ModAPI:()=>e.Cy,ModAPI_C:()=>e.M5});var e=__webpack_require__(791);class t extends e.Vb{constructor(){super(...arguments),this.name="MBLogger",this.description="The default logger for modbox.",this.version="0.0.1",this.namespace="mblogger"}init(){}CreateLogger(e){return new o(e)}}class o{constructor(e){this.name=e}getTime(){let e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`}log(...e){console.log(`[${this.getTime()}] [${this.name}]`,...e)}info(...e){console.info(`[${this.getTime()}] [${this.name}] [INFO]`,...e)}warn(...e){console.warn(`[${this.getTime()}] [${this.name}] [WARN]`,...e)}error(...e){console.error(`[${this.getTime()}] [${this.name}] [ERROR]`,...e)}}class r extends e.Vb{constructor(){super(...arguments),this.name="rmtrollbox",this.description="rmtrollbox API",this.version="0.0.1",this.namespace="rmtrollbox",this.logger=e.Cy.GetMod("mblogger").CreateLogger("rmtrollbox"),this.registeredCommands=[]}init(){this.logger.log("Initializing rmtrollbox API"),e.Cy.Hook("sendMsg").on("call",(e=>{let t=e.data.funcargs[0];if(t.startsWith("/")){let o=t.substr(1).split(" "),r=o.shift(),i="";r.includes(":")&&(i=r.split(":")[0],r=r.split(":")[1]);let n=this.registeredCommands.filter((e=>i?e.namespace===i&&(e.name===r||e.aliases.includes(r)):e.name==r||e.aliases.includes(r)));n.length>0&&(e.preventDefault(),n[0].execute(o))}})),this.logger.info("rmtrollbox api initialized")}PrintMessage(e){window.printMsg(e)}RegisterCommand(e){this.registeredCommands.push(e)}GetElement(e){return document.querySelector(`#trollbox > ${e.GetSelector()}`)}OpenPopup(e){return new Promise((t=>{window.popup(e,t)}))}}class i{constructor(e,t){this.name=e,this.element=t,this._children=[]}GetSelector(){return this.element}SetChildren(e){return this._children=e.map((e=>(e.element=`${this.element} > ${e.element}`,e))),this}Get(e){let t=this._children.find((t=>t.name===e));if(!t)throw new Error(`No child named ${e}`);return t}get children(){return Object.fromEntries(this._children.map((e=>[e.name,e])))}}new i("Form","#trollbox_form").SetChildren([new i("Input","textarea#trollbox_input"),new i("SendButton","button"),new i("NickButton","button#trollbox_nick_btn"),new i("UploadButton","button#trollbox_upload_btn")]);class n extends e.Vb{constructor(){super(...arguments),this.name="ModStorage",this.description="A mod that stores mod data",this.version="0.0.1",this.namespace="storage"}init(){}GetStorage(e){return new s(e)}}class s{constructor(e){this.name=e}Get(e){return localStorage.getItem(`${this.name}/${e}`)}Set(e,t){localStorage.setItem(`${this.name}/${e}`,t)}Remove(e){localStorage.removeItem(`${this.name}/${e}`)}List(){let e=Object.keys(localStorage),t=[];for(let o=0;o<e.length;o++)e[o].startsWith(this.name+"/")&&t.push(e[o].replace(`${this.name}/`,""));return t}Clear(){this.List().forEach((e=>{this.Remove(e)}))}}var a=__webpack_require__(462);class l extends e.Vb{constructor(){super(...arguments),this.name="Mod Loader",this.description="A mod that loads mods",this.version="0.0.1",this.namespace="modloader",this.logger=e.Cy.GetMod("mblogger").CreateLogger("modloader")}init(){this.logger.info("Loading mods...");let t=e.Cy.GetMod("storage").GetStorage("mods");t.List(),this.logger.info(`Found ${t.List().length} mods`);for(let o=0;o<t.List().length;o++){let r=t.List()[o],i=t.Get(r);this.logger.info(`Loading ${r}`);let n=e.Cy.FilterMods("loader-"),s=!1;for(let t of n)if(t.CanLoad(r)){this.logger.info(`Loading mod ${r} with loader ${t.name}`),e.Cy.LoadMod(t.Load(i)),this.logger.info(`Loaded ${r}`),s=!0;break}s||this.logger.error(`Could not load mod ${r}: no loader found for it`)}this.logger.info(`${e.Cy.GetMods().length} Mods loaded`)}}setTimeout((()=>{window.modbox.ModAPI.LoadMod(t),window.modbox.ModAPI.LoadMod(r),window.modbox.ModAPI.LoadMod(n),window.modbox.ModAPI.LoadMod(a.Z),window.modbox.ModAPI.LoadMod(l)}),500)})(),__webpack_exports__})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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N0I1RSxPQUFPZ0ksT0FBT3hGLE9BQU90QixRQUFRNEYsR0FFN0I5RyxPQUFPZ0ksT0FBT3hGLE9BQU90QixRQUFRLEtBRTdCbEIsT0FBT2dJLE9BQU94RixPQUFPdEIsUUFBUTBHLEtBQzlCLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb2Rib3gvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL21vZGJveC8uL3NyYy9sb2FkZXItanMudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL2V2ZW50cy50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvdXRpbC50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvbW9kYXBpLnRzIiwid2VicGFjazovL21vZGJveC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9tb2Rib3gvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21vZGJveC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL21vZGJveC93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL21vZGJveC8uL3NyYy9tYmxvZ2dlci50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvcm10cm9sbGJveC50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvbW9kc3RvcmFnZS50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wibW9kYm94XCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIm1vZGJveFwiXSA9IGZhY3RvcnkoKTtcbn0pKHNlbGYsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsImltcG9ydCB7IE1vZCB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMb2FkZXJNb2QgZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwiSmF2YVNjcmlwdCBMb2FkZXJcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJUaGUgZGVmYXVsdCBsb2FkZXIgZm9yIG1vZGJveC5cIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcImxvYWRlci1qc1wiO1xyXG4gICAgTG9hZChkYXRhOiBzdHJpbmcpOiBNb2Qge1xyXG4gICAgICAgIHJldHVybiBldmFsKGAoZnVuY3Rpb24oKXtyZXR1cm4gJHtkYXRhfX0pKCk7YCkgYXMgTW9kO1xyXG4gICAgfVxyXG4gICAgQ2FuTG9hZChmaWxlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZmlsZS5lbmRzV2l0aChcIi5qc1wiKTtcclxuICAgIH1cclxufSIsImludGVyZmFjZSBjYWxsYmFja2R1YyB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBGdW5jdGlvbltdO1xyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50RW1pdHRlciB7XHJcbiAgICBwdWJsaWMgX2NhbGxiYWNrczogY2FsbGJhY2tkdWM7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSB7fTtcclxuICAgIH1cclxuICAgIG9uKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdKSB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spO1xyXG4gICAgfVxyXG4gICAgb2ZmKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0uZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gY2FsbGJhY2spIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIG9uY2UoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIHRoaXMub24oZXZlbnROYW1lLCAoLi4uZDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZCk7XHJcbiAgICAgICAgICAgIHRoaXMub2ZmKGV2ZW50TmFtZSwgYXJndW1lbnRzLmNhbGxlZSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIGVtaXQoZXZlbnROYW1lOiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLmZvckVhY2goeCA9PiB4KC4uLmFyZ3MpKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgRXZlbnQge1xyXG4gICAgcHVibGljIGRlZmF1bHRQcmV2ZW50ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsIHB1YmxpYyBkYXRhOiBhbnksIHB1YmxpYyBkZWZhdWx0YWN0aW9uOiBGdW5jdGlvbikge307XHJcbiAgICBwcmV2ZW50RGVmYXVsdCgpIHtcclxuICAgICAgICB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgcnVuX2RlZmF1bHQoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdFByZXZlbnRlZCkgdGhpcy5kZWZhdWx0YWN0aW9uKC4uLmFyZ3MpO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpIHtyZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSl9O1xyXG5leHBvcnQgbmFtZXNwYWNlIGFycmF5IHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBkZWVwQ2xvbmUoYXJyOiBhbnlbXSk6IGFueVtdIHtcclxuICAgICAgICBsZXQgbmV3YXJyOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gYXJyW2ldO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIpIGRhdGEgPSBvYmplY3QuZGVlcENsb25lKGRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgZGF0YSA9IGRlZXBDbG9uZShkYXRhKTtcclxuICAgICAgICAgICAgbmV3YXJyLnB1c2goZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXdhcnI7XHJcbiAgICB9O1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZShpbmRleDogbnVtYmVyLCBhcnI6IGFueVtdKXtcclxuICAgICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IG5hbWVzcGFjZSBvYmplY3Qge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGhhc0Z1bmN0aW9ucyhvYmo6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGZvciAobGV0IGl0ZW0gaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2l0ZW1dID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9ialtpdGVtXSA9PT0gXCJvYmplY3RcIikgcmV0dXJuIGhhc0Z1bmN0aW9ucyhvYmpbaXRlbV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVlcENsb25lKG9iajogYW55KTogYW55IHtcclxuICAgICAgICBpZiAoKHdpbmRvdyBhcyBhbnkpLnN0cnVjdHVyZWRDbG9uZSkgcmV0dXJuICh3aW5kb3cgYXMgYW55KS5zdHJ1Y3R1cmVkQ2xvbmUob2JqKVxyXG4gICAgICAgIGlmICghaGFzRnVuY3Rpb25zKG9iaikpIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xyXG4gICAgICAgIGxldCBuZXdvYmo6IGFueSA9IHt9O1xyXG4gICAgICAgIGZvciAobGV0IGl0ZW0gaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2l0ZW1dID09PSBcIm9iamVjdFwiKSB7bmV3b2JqW2l0ZW1dID0gZGVlcENsb25lKG9ialtpdGVtXSk7IGNvbnRpbnVlfVxyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmpbaXRlbV0pKSB7bmV3b2JqW2l0ZW1dID0gYXJyYXkuZGVlcENsb25lKG9ialtpdGVtXSk7IGNvbnRpbnVlfVxyXG4gICAgICAgICAgICBuZXdvYmpbaXRlbV0gPSBvYmpbaXRlbV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IEV2ZW50RW1pdHRlciwgeyBFdmVudCB9IGZyb20gXCIuL2V2ZW50c1wiO1xyXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vdXRpbCc7XHJcbmxldCB3aW5vID0gd2luZG93IGFzIGFueTtcclxuXHJcbmV4cG9ydCBjbGFzcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwibm8gbmFtZVwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIm5vIGRlc2NyaXB0aW9uXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMFwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtb2RcIjtcclxuICAgIGluaXQoKSB7fVxyXG59XHJcbmV4cG9ydCBjbGFzcyBNb2RBUElfQyBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNb2RBUElcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJBIEFQSSBmb3Igcm10cm9sbGJveCBtb2RzXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtb2RhcGlcIjtcclxuICAgIHByaXZhdGUgbG9hZGVkOiBNb2RbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBob29rczoge1trZXk6IHN0cmluZ106IEV2ZW50RW1pdHRlcn0gPSB7fTtcclxuICAgIHB1YmxpYyBHZXRNb2Q8VD4obmFtZXNwYWNlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYSA9IHRoaXMubG9hZGVkLmZpbmQoeCA9PiB4Lm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlKTtcclxuICAgICAgICBpZiAoIWEpIHRocm93IG5ldyBFcnJvcihgTW9kIHdpdGggbmFtZXNwYWNlICR7bmFtZXNwYWNlfSBub3QgZm91bmQuYCk7XHJcbiAgICAgICAgcmV0dXJuIGEgYXMgdW5rbm93biBhcyBUO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldE1vZEJ5TmFtZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZWQuZmluZCh4ID0+IHgubmFtZSA9PT0gbmFtZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgR2V0TW9kcygpOiBNb2RbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkO1xyXG4gICAgfVxyXG4gICAgcHVibGljIExvYWRNb2QobW9kOiBhbnkpIHtcclxuICAgICAgICBsZXQgbG1vZDogTW9kID0gbmV3IG1vZCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWRlZC5maW5kKHggPT4geC5uYW1lID09PSBsbW9kLm5hbWUpKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5sb2FkZWQucHVzaChsbW9kKTtcclxuICAgICAgICBsbW9kLmluaXQoKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZXBsYWNlTW9kKG1vZDogTW9kLCBuZXdtb2Q6IE1vZCkge1xyXG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMubG9hZGVkLmZpbmRJbmRleCh4ID0+IHgubmFtZSA9PT0gbW9kLm5hbWUpO1xyXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHJldHVybjtcclxuICAgICAgICB0aGlzLmxvYWRlZFtpbmRleF0gPSBuZXdtb2Q7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgSG9vayhmdW5jdGlvbl9uYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAodGhpcy5ob29rc1tmdW5jdGlvbl9uYW1lXSkgcmV0dXJuIHRoaXMuaG9va3NbZnVuY3Rpb25fbmFtZV07XHJcbiAgICAgICAgbGV0IGV2ZW0gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgbGV0IG9nZnVuYyA9IHdpbm9bZnVuY3Rpb25fbmFtZV07XHJcbiAgICAgICAgd2lub1tmdW5jdGlvbl9uYW1lXSA9IChhc3luYyBmdW5jdGlvbiAob2dmdW5jOiBGdW5jdGlvbiwgLi4uZmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgICAgIGxldCBuYXJncyA9IHV0aWwuYXJyYXkuZGVlcENsb25lKGZhcmdzKTtcclxuICAgICAgICAgICAgZXZlbS5lbWl0KCdiZWZvcmVfY2FsbCcsIG5hcmdzKTsgLy8geW91IGNhbiB1c2UgYmVmb3JlIGNhbGwgdG8gcXVpY2tseSBtb2RpZnkgdGhlIGFyZ3VtZW50c1xyXG4gICAgICAgICAgICBsZXQgZmV2ZW50ID0gbmV3IEV2ZW50KCdob29rZWRfZnVuY3Rpb25fY2FsbCcsIHtmdW5jYXJnczogbmFyZ3N9LCBvZ2Z1bmMpO1xyXG4gICAgICAgICAgICBldmVtLmVtaXQoJ2NhbGwnLGZldmVudCk7XHJcbiAgICAgICAgICAgIGF3YWl0IHV0aWwuc2xlZXAoODApO1xyXG4gICAgICAgICAgICBmZXZlbnQucnVuX2RlZmF1bHQoLi4ubmFyZ3MpO1xyXG4gICAgICAgICAgICBldmVtLmVtaXQoXCJhZnRlcl9jYWxsXCIpO1xyXG4gICAgICAgIH0pLmJpbmQodGhpcywgb2dmdW5jKTtcclxuICAgICAgICB0aGlzLmhvb2tzW2Z1bmN0aW9uX25hbWVdID0gZXZlbTtcclxuICAgICAgICByZXR1cm4gZXZlbTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBGaWx0ZXJNb2RzPFQ+KHByZWZpeDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkLmZpbHRlcih4ID0+IHgubmFtZXNwYWNlLnN0YXJ0c1dpdGgocHJlZml4KSkgYXMgdW5rbm93biBhcyBUW107XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNvbnN0IE1vZEFQSSA9IG5ldyBNb2RBUElfQygpOyIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgTW9kIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1CTG9nZ2VyIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1CTG9nZ2VyXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiVGhlIGRlZmF1bHQgbG9nZ2VyIGZvciBtb2Rib3guXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtYmxvZ2dlclwiO1xyXG4gICAgcHVibGljIGluaXQoKSB7fVxyXG4gICAgcHVibGljIENyZWF0ZUxvZ2dlcihuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IExvZ2dlcihuYW1lKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgTG9nZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcpIHt9XHJcbiAgICBwcml2YXRlIGdldFRpbWUoKSB7XHJcbiAgICAgICAgbGV0IGQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGxldCBob3VyID0gZC5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xyXG4gICAgICAgIGxldCBtaW51dGUgPSBkLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuICAgICAgICBsZXQgc2Vjb25kID0gZC5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgICAgICAgcmV0dXJuIGAke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH1gO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGxvZyguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgaW5mbyguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XSBbSU5GT11gLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyB3YXJuKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dIFtXQVJOXWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGVycm9yKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XSBbRVJST1JdYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBNb2QsIE1vZEFQSSB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5pbXBvcnQgTUJMb2dnZXIgZnJvbSBcIi4vbWJsb2dnZXJcIjtcclxuaW1wb3J0IEV2ZW50RW1pdHRlciwge0V2ZW50fSBmcm9tIFwiLi9ldmVudHNcIjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2Ugcm1NZXNzYWdlIHtcclxuICAgIG5pY2s6IHN0cmluZztcclxuICAgIGhvbWU6IHN0cmluZztcclxuICAgIG1zZzogc3RyaW5nO1xyXG4gICAgZGF0ZTogbnVtYmVyO1xyXG4gICAgY29sb3I6IHN0cmluZztcclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIENvbW1hbmQge1xyXG4gICAgbmFtZXNwYWNlOiBzdHJpbmc7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xyXG4gICAgdXNhZ2U6IHN0cmluZztcclxuICAgIGFsaWFzZXM6IHN0cmluZ1tdO1xyXG4gICAgZXhlY3V0ZTogKGFyZ3M6IHN0cmluZ1tdKSA9PiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBybXRyb2xsYm94IGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcInJtdHJvbGxib3hcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJybXRyb2xsYm94IEFQSVwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwicm10cm9sbGJveFwiO1xyXG4gICAgcHVibGljIGxvZ2dlciA9IE1vZEFQSS5HZXRNb2Q8TUJMb2dnZXI+KFwibWJsb2dnZXJcIikuQ3JlYXRlTG9nZ2VyKFwicm10cm9sbGJveFwiKTtcclxuICAgIHByaXZhdGUgcmVnaXN0ZXJlZENvbW1hbmRzOiBDb21tYW5kW10gPSBbXTtcclxuICAgIHB1YmxpYyBpbml0KCkge1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhcIkluaXRpYWxpemluZyBybXRyb2xsYm94IEFQSVwiKTtcclxuICAgICAgICBsZXQgc25kTXNnSG9vayA9IE1vZEFQSS5Ib29rKFwic2VuZE1zZ1wiKTtcclxuICAgICAgICBzbmRNc2dIb29rLm9uKFwiY2FsbFwiLCAoZXY6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtc2cgPSBldi5kYXRhLmZ1bmNhcmdzWzBdO1xyXG4gICAgICAgICAgICBpZiAobXNnLnN0YXJ0c1dpdGgoJy8nKSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBtc2cuc3Vic3RyKDEpLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgY21kID0gYXJncy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5hbWVzcGFjZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21kLmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2UgPSBjbWQuc3BsaXQoJzonKVswXTtcclxuICAgICAgICAgICAgICAgICAgICBjbWQgPSBjbWQuc3BsaXQoJzonKVsxXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCBjbWRzID0gdGhpcy5yZWdpc3RlcmVkQ29tbWFuZHMuZmlsdGVyKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMubmFtZXNwYWNlID09PSBuYW1lc3BhY2UgJiYgKGMubmFtZSA9PT0gY21kIHx8IGMuYWxpYXNlcy5pbmNsdWRlcyhjbWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLm5hbWUgPT0gY21kIHx8IGMuYWxpYXNlcy5pbmNsdWRlcyhjbWQpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21kcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBjbWRzWzBdLmV4ZWN1dGUoYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJybXRyb2xsYm94IGFwaSBpbml0aWFsaXplZFwiKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBQcmludE1lc3NhZ2UobXNnOiBybU1lc3NhZ2UpIHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICB3aW5kb3cucHJpbnRNc2cobXNnKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZWdpc3RlckNvbW1hbmQoY21kOiBDb21tYW5kKSB7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkQ29tbWFuZHMucHVzaChjbWQpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldEVsZW1lbnQodWllbGVtZW50OiBVSUVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ryb2xsYm94ID4gJHt1aWVsZW1lbnQuR2V0U2VsZWN0b3IoKX1gKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBPcGVuUG9wdXAoaHRtbDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgd2luZG93LnBvcHVwKGh0bWwscmVzb2x2ZSk7IC8vIHJlc29sdmUgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgcG9wdXAgaXMgb3BlblxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuY2xhc3MgVUlFbGVtZW50IHtcclxuICAgIHByaXZhdGUgX2NoaWxkcmVuOiBVSUVsZW1lbnRbXSA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZywgcHVibGljIGVsZW1lbnQ6IHN0cmluZykge31cclxuICAgIHB1YmxpYyBHZXRTZWxlY3RvcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xyXG4gICAgfVxyXG4gICAgcHVibGljIFNldENoaWxkcmVuKGNoaWxkczogVUlFbGVtZW50W10pIHtcclxuICAgICAgICB0aGlzLl9jaGlsZHJlbiA9IGNoaWxkcy5tYXAoeCA9PiB7XHJcbiAgICAgICAgICAgIHguZWxlbWVudCA9IGAke3RoaXMuZWxlbWVudH0gPiAke3guZWxlbWVudH1gO1xyXG4gICAgICAgICAgICByZXR1cm4geDtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHB1YmxpYyBHZXQobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGEgPSB0aGlzLl9jaGlsZHJlbi5maW5kKHggPT4geC5uYW1lID09PSBuYW1lKTtcclxuICAgICAgICBpZiAoIWEpIHRocm93IG5ldyBFcnJvcihgTm8gY2hpbGQgbmFtZWQgJHtuYW1lfWApO1xyXG4gICAgICAgIHJldHVybiBhO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNoaWxkcmVuKCk6IHtba2V5OiBzdHJpbmddOiBVSUVsZW1lbnR9IHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHRoaXMuX2NoaWxkcmVuLm1hcCh4ID0+IFt4Lm5hbWUsIHhdKSlcclxuICAgIH1cclxufVxyXG4vKmV4cG9ydCBjb25zdCBVSSA9IHtcclxuICAgIEZvcm06IHtcclxuICAgICAgICBfX2NvbWJpbmU6IFwiI3Ryb2xsYm94X2Zvcm1cIixcclxuICAgICAgICBnZXQgSW5wdXQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9fY29tYmluZX0gPiB0ZXh0YXJlYSN0cm9sbGJveF9pbnB1dGA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXQgU2VuZEJ1dHRvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX19jb21iaW5lfSA+IGJ1dHRvbmA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXQgTmlja0J1dHRvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX19jb21iaW5lfSA+IGJ1dHRvbiN0cm9sbGJveF9uaWNrX2J0bmA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXQgVXBsb2FkQnV0dG9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gYnV0dG9uI3Ryb2xsYm94X3VwbG9hZF9idG5gO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSovXHJcbmV4cG9ydCBjb25zdCBVSSA9IHtcclxuICAgIEZvcm06IG5ldyBVSUVsZW1lbnQoXCJGb3JtXCIsIFwiI3Ryb2xsYm94X2Zvcm1cIikuU2V0Q2hpbGRyZW4oW1xyXG4gICAgICAgIG5ldyBVSUVsZW1lbnQoXCJJbnB1dFwiLCBcInRleHRhcmVhI3Ryb2xsYm94X2lucHV0XCIpLFxyXG4gICAgICAgIG5ldyBVSUVsZW1lbnQoXCJTZW5kQnV0dG9uXCIsIFwiYnV0dG9uXCIpLFxyXG4gICAgICAgIG5ldyBVSUVsZW1lbnQoXCJOaWNrQnV0dG9uXCIsIFwiYnV0dG9uI3Ryb2xsYm94X25pY2tfYnRuXCIpLFxyXG4gICAgICAgIG5ldyBVSUVsZW1lbnQoXCJVcGxvYWRCdXR0b25cIiwgXCJidXR0b24jdHJvbGxib3hfdXBsb2FkX2J0blwiKVxyXG5cclxuICAgIF0pXHJcbn1cclxuIiwiaW1wb3J0IHsgTW9kIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZFN0b3JhZ2UgZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwiTW9kU3RvcmFnZVwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIkEgbW9kIHRoYXQgc3RvcmVzIG1vZCBkYXRhXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJzdG9yYWdlXCI7XHJcbiAgICBwdWJsaWMgaW5pdCgpIHt9XHJcbiAgICBwdWJsaWMgR2V0U3RvcmFnZShuYW1lOiBzdHJpbmcpOiBTdG9yYWdlRGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTdG9yYWdlRGF0YShuYW1lKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBTdG9yYWdlRGF0YSB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nKSB7fVxyXG4gICAgcHVibGljIEdldChrZXk6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGAke3RoaXMubmFtZX0vJHtrZXl9YCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgU2V0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7dGhpcy5uYW1lfS8ke2tleX1gLCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgUmVtb3ZlKGtleTogc3RyaW5nKSB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYCR7dGhpcy5uYW1lfS8ke2tleX1gKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBMaXN0KCkge1xyXG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMobG9jYWxTdG9yYWdlKTtcclxuICAgICAgICBsZXQgbW9kcyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoa2V5c1tpXS5zdGFydHNXaXRoKHRoaXMubmFtZStcIi9cIikpIHtcclxuICAgICAgICAgICAgICAgIG1vZHMucHVzaChrZXlzW2ldLnJlcGxhY2UoYCR7dGhpcy5uYW1lfS9gLCBcIlwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1vZHM7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgQ2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5MaXN0KCkuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLlJlbW92ZShrZXkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgTW9kQVBJLCBNb2QsIE1vZEFQSV9DIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmltcG9ydCBNQkxvZ2dlciBmcm9tIFwiLi9tYmxvZ2dlclwiO1xyXG5pbXBvcnQgcm10cm9sbGJveCBmcm9tIFwiLi9ybXRyb2xsYm94XCI7XHJcbmltcG9ydCBNb2RTdG9yYWdlIGZyb20gXCIuL21vZHN0b3JhZ2VcIjtcclxuaW1wb3J0IExvYWRlck1vZCBmcm9tIFwiLi9sb2FkZXItanNcIjtcclxuXHJcbmNsYXNzIE1vZExvYWRlciBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNb2QgTG9hZGVyXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiQSBtb2QgdGhhdCBsb2FkcyBtb2RzXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJtb2Rsb2FkZXJcIjtcclxuICAgIHByaXZhdGUgbG9nZ2VyID0gTW9kQVBJLkdldE1vZDxNQkxvZ2dlcj4oXCJtYmxvZ2dlclwiKS5DcmVhdGVMb2dnZXIoXCJtb2Rsb2FkZXJcIik7XHJcbiAgICBwdWJsaWMgaW5pdCgpIHtcclxuICAgICAgICAvKi8vQHRzLWlnbm9yZVxyXG4gICAgICAgIHdpbmRvdy5Nb2RBUEkgPSBNb2RBUEk7IC8vIGV4cG9zZSB0aGUgTW9kQVBJIHRvIHRoZSB3aW5kb3dcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdNb2RBUEkgZXhwb3NlZCB0byB3aW5kb3cnKTtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICB3aW5kb3cuTW9kID0gTW9kO1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ01vZCBjbGFzcyBleHBvc2VkIHRvIHdpbmRvdycpOyovXHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnTG9hZGluZyBtb2RzLi4uJyk7XHJcbiAgICAgICAgbGV0IG1vZHMgPSBNb2RBUEkuR2V0TW9kPE1vZFN0b3JhZ2U+KFwic3RvcmFnZVwiKS5HZXRTdG9yYWdlKFwibW9kc1wiKVxyXG4gICAgICAgIGxldCBtb2RMaXN0ID0gbW9kcy5MaXN0KCk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRm91bmQgJHttb2RzLkxpc3QoKS5sZW5ndGh9IG1vZHNgKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vZHMuTGlzdCgpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBtb2ROYW1lID0gbW9kcy5MaXN0KClbaV1cclxuICAgICAgICAgICAgbGV0IG1vZCA9IG1vZHMuR2V0KG1vZE5hbWUpXHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYExvYWRpbmcgJHttb2ROYW1lfWApO1xyXG4gICAgICAgICAgICBsZXQgbG9hZGVycyA9IE1vZEFQSS5GaWx0ZXJNb2RzPExvYWRlck1vZD4oXCJsb2FkZXItXCIpO1xyXG4gICAgICAgICAgICBsZXQgbG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGxvYWRlciBvZiBsb2FkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobG9hZGVyLkNhbkxvYWQobW9kTmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBMb2FkaW5nIG1vZCAke21vZE5hbWV9IHdpdGggbG9hZGVyICR7bG9hZGVyLm5hbWV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgTW9kQVBJLkxvYWRNb2QobG9hZGVyLkxvYWQobW9kKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGVkICR7bW9kTmFtZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghbG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihgQ291bGQgbm90IGxvYWQgbW9kICR7bW9kTmFtZX06IG5vIGxvYWRlciBmb3VuZCBmb3IgaXRgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGAke01vZEFQSS5HZXRNb2RzKCkubGVuZ3RofSBNb2RzIGxvYWRlZGApO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBNb2QsIE1vZEFQSSwgTW9kQVBJX0MgfTtcclxuXHJcbnNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICB3aW5kb3cubW9kYm94Lk1vZEFQSS5Mb2FkTW9kKE1CTG9nZ2VyKTtcclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgd2luZG93Lm1vZGJveC5Nb2RBUEkuTG9hZE1vZChybXRyb2xsYm94KTtcclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgd2luZG93Lm1vZGJveC5Nb2RBUEkuTG9hZE1vZChNb2RTdG9yYWdlKTtcclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgd2luZG93Lm1vZGJveC5Nb2RBUEkuTG9hZE1vZChMb2FkZXJNb2QpO1xyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICB3aW5kb3cubW9kYm94Lk1vZEFQSS5Mb2FkTW9kKE1vZExvYWRlcik7XHJcbn0sIDUwMClcclxuIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJMb2FkZXJNb2QiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJ2ZXJzaW9uIiwibmFtZXNwYWNlIiwiTG9hZCIsImRhdGEiLCJldmFsIiwiQ2FuTG9hZCIsImZpbGUiLCJlbmRzV2l0aCIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidGhpcyIsIl9jYWxsYmFja3MiLCJvbiIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwicHVzaCIsIm9mZiIsImZvckVhY2giLCJ2YWx1ZSIsImluZGV4Iiwic3BsaWNlIiwib25jZSIsImQiLCJhcmd1bWVudHMiLCJjYWxsZWUiLCJlbWl0IiwiYXJncyIsIngiLCJFdmVudCIsImRlZmF1bHRhY3Rpb24iLCJkZWZhdWx0UHJldmVudGVkIiwicHJldmVudERlZmF1bHQiLCJydW5fZGVmYXVsdCIsImFycmF5Iiwib2JqZWN0IiwiZGVlcENsb25lIiwiYXJyIiwibmV3YXJyIiwiaSIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsInJlbW92ZSIsImhhc0Z1bmN0aW9ucyIsIm9iaiIsIml0ZW0iLCJ3aW5kb3ciLCJzdHJ1Y3R1cmVkQ2xvbmUiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJuZXdvYmoiLCJ3aW5vIiwiTW9kIiwiaW5pdCIsIk1vZEFQSV9DIiwibG9hZGVkIiwiaG9va3MiLCJHZXRNb2QiLCJhIiwiZmluZCIsIkVycm9yIiwiR2V0TW9kQnlOYW1lIiwiR2V0TW9kcyIsIkxvYWRNb2QiLCJtb2QiLCJsbW9kIiwiUmVwbGFjZU1vZCIsIm5ld21vZCIsImZpbmRJbmRleCIsIkhvb2siLCJmdW5jdGlvbl9uYW1lIiwiZXZlbSIsIm9nZnVuYyIsImZhcmdzIiwibmFyZ3MiLCJmZXZlbnQiLCJmdW5jYXJncyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImJpbmQiLCJGaWx0ZXJNb2RzIiwicHJlZml4IiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsIk1vZEFQSSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJNQkxvZ2dlciIsIkNyZWF0ZUxvZ2dlciIsIkxvZ2dlciIsImdldFRpbWUiLCJEYXRlIiwiZ2V0SG91cnMiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJsb2ciLCJjb25zb2xlIiwiaW5mbyIsIndhcm4iLCJlcnJvciIsInJtdHJvbGxib3giLCJsb2dnZXIiLCJyZWdpc3RlcmVkQ29tbWFuZHMiLCJldiIsIm1zZyIsInN1YnN0ciIsInNwbGl0IiwiY21kIiwic2hpZnQiLCJpbmNsdWRlcyIsImNtZHMiLCJjIiwiYWxpYXNlcyIsImV4ZWN1dGUiLCJQcmludE1lc3NhZ2UiLCJwcmludE1zZyIsIlJlZ2lzdGVyQ29tbWFuZCIsIkdldEVsZW1lbnQiLCJ1aWVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJHZXRTZWxlY3RvciIsIk9wZW5Qb3B1cCIsImh0bWwiLCJwb3B1cCIsIlVJRWxlbWVudCIsImVsZW1lbnQiLCJfY2hpbGRyZW4iLCJTZXRDaGlsZHJlbiIsImNoaWxkcyIsIm1hcCIsIkdldCIsImNoaWxkcmVuIiwiZnJvbUVudHJpZXMiLCJNb2RTdG9yYWdlIiwiR2V0U3RvcmFnZSIsIlN0b3JhZ2VEYXRhIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIlNldCIsInNldEl0ZW0iLCJSZW1vdmUiLCJyZW1vdmVJdGVtIiwiTGlzdCIsImtleXMiLCJtb2RzIiwicmVwbGFjZSIsIkNsZWFyIiwiTW9kTG9hZGVyIiwibW9kTmFtZSIsImxvYWRlcnMiLCJsb2FkZXIiLCJtb2Rib3giXSwic291cmNlUm9vdCI6IiJ9