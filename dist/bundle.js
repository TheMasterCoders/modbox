!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.modbox=t():e.modbox=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>LoaderMod});var _modapi__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(791);class LoaderMod extends _modapi__WEBPACK_IMPORTED_MODULE_0__.Vb{constructor(){super(...arguments),this.name="JavaScript Loader",this.description="The default loader for modbox.",this.version="0.0.1",this.namespace="loader-js"}Load(data){return eval(`(function(){return ${data}})();`)}CanLoad(e){return e.endsWith(".js")}}},791:(e,t,o)=>{o.d(t,{Vb:()=>d,Cy:()=>c,M5:()=>l});class r{constructor(){this._callbacks={}}on(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}off(e,t){this._callbacks[e]&&this._callbacks[e].forEach(((o,r)=>{o===t&&this._callbacks[e].splice(r,1)}))}once(e,t){this.on(e,((...o)=>{t(o),this.off(e,arguments.callee)}))}emit(e,...t){this._callbacks[e]&&this._callbacks[e].forEach((e=>e(...t)))}}class i{constructor(e,t,o){this.name=e,this.data=t,this.defaultaction=o,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}run_default(...e){this.defaultPrevented||this.defaultaction(...e)}}var s,n;!function(e){e.deepClone=function e(t){let o=[];for(let r=0;r<t.length;r++){let i=t[r];"object"==typeof i&&(i=n.deepClone(i)),Array.isArray(i)&&(i=e(i)),o.push(i)}return o},e.remove=function(e,t){return t.splice(e,1)}}(s||(s={})),function(e){function t(e){for(let o in e){if("function"==typeof e[o])return!0;if("object"==typeof e[o])return t(e[o])}return!1}e.hasFunctions=t,e.deepClone=function e(o){if(window.structuredClone)return window.structuredClone(o);if(!t(o))return JSON.parse(JSON.stringify(o));let r={};for(let t in o)"object"!=typeof o[t]?Array.isArray(o[t])?r[t]=s.deepClone(o[t]):r[t]=o[t]:r[t]=e(o[t])}}(n||(n={}));let a=window;class d{constructor(){this.name="no name",this.description="no description",this.version="0.0.0",this.namespace="mod"}init(){}}class l extends d{constructor(){super(...arguments),this.name="ModAPI",this.description="A API for rmtrollbox mods",this.version="0.0.1",this.namespace="modapi",this.loaded=[],this.hooks={}}GetMod(e){let t=this.loaded.find((t=>t.namespace===e));if(!t)throw new Error(`Mod with namespace ${e} not found.`);return t}GetModByName(e){return this.loaded.find((t=>t.name===e))}GetMods(){return this.loaded}LoadMod(e){let t=new e;this.loaded.find((e=>e.name===t.name))||(this.loaded.push(t),t.init())}ReplaceMod(e,t){let o=this.loaded.findIndex((t=>t.name===e.name));-1!==o&&(this.loaded[o]=t)}Hook(e){if(this.hooks[e])return this.hooks[e];let t=new r,o=a[e];return a[e]=async function(e,...o){let r=s.deepClone(o);t.emit("before_call",r);let n=new i("hooked_function_call",{funcargs:r},e);t.emit("call",n),await(80,new Promise((e=>setTimeout(e,80)))),n.run_default(...r),t.emit("after_call")}.bind(this,o),this.hooks[e]=t,t}FilterMods(e){return this.loaded.filter((t=>t.namespace.startsWith(e)))}}const c=new l}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Mod:()=>e.Vb,ModAPI:()=>e.Cy,ModAPI_C:()=>e.M5});var e=__webpack_require__(791);class t extends e.Vb{constructor(){super(...arguments),this.name="MBLogger",this.description="The default logger for modbox.",this.version="0.0.1",this.namespace="mblogger"}init(){}CreateLogger(e){return new o(e)}}class o{constructor(e){this.name=e}getTime(){let e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`}log(...e){console.log(`[${this.getTime()}] [${this.name}]`,...e)}info(...e){console.info(`[${this.getTime()}] [${this.name}] [INFO]`,...e)}warn(...e){console.warn(`[${this.getTime()}] [${this.name}] [WARN]`,...e)}error(...e){console.error(`[${this.getTime()}] [${this.name}] [ERROR]`,...e)}}class r extends e.Vb{constructor(){super(...arguments),this.name="rmtrollbox",this.description="rmtrollbox API",this.version="0.0.1",this.namespace="rmtrollbox",this.logger=e.Cy.GetMod("mblogger").CreateLogger("rmtrollbox"),this.registeredCommands=[]}init(){this.logger.log("Initializing rmtrollbox API"),e.Cy.Hook("sendMsg").on("call",(e=>{let t=e.data.funcargs[0];if(t.startsWith("/")){let o=t.substr(1).split(" "),r=o.shift(),i="";r.includes(":")&&(i=r.split(":")[0],r=r.split(":")[1]);let s=this.registeredCommands.filter((e=>i?e.namespace===i&&(e.name===r||e.aliases.includes(r)):e.name==r||e.aliases.includes(r)));s.length>0&&(e.preventDefault(),s[0].execute(o))}})),this.logger.info("rmtrollbox api initialized")}PrintMessage(e){window.printMsg(e)}RegisterCommand(e){this.registeredCommands.push(e)}GetElement(e){return document.querySelector(`#trollbox > ${e.GetSelector()}`)}OpenPopup(e){return new Promise((t=>{window.popup(e,t)}))}}class i{constructor(e,t){this.name=e,this.element=t,this._children=[]}GetSelector(){return this.element}SetChildren(e){return this._children=e.map((e=>(e.element=`${this.element} > ${e.element}`,e))),this}Get(e){let t=this._children.find((t=>t.name===e));if(!t)throw new Error(`No child named ${e}`);return t}get children(){return Object.fromEntries(this._children.map((e=>[e.name,e])))}}new i("Form","#trollbox_form").SetChildren([new i("Input","textarea#trollbox_input"),new i("SendButton","button"),new i("NickButton","button#trollbox_nick_btn"),new i("UploadButton","button#trollbox_upload_btn")]);class s extends e.Vb{constructor(){super(...arguments),this.name="ModStorage",this.description="A mod that stores mod data",this.version="0.0.1",this.namespace="storage"}init(){}GetStorage(e){return new n(e)}}class n{constructor(e){this.name=e}Get(e){return localStorage.getItem(`${this.name}/${e}`)}Set(e,t){localStorage.setItem(`${this.name}/${e}`,t)}Remove(e){localStorage.removeItem(`${this.name}/${e}`)}List(){let e=Object.keys(localStorage),t=[];for(let o=0;o<e.length;o++)e[o].startsWith(this.name+"/")&&t.push(e[o].replace(`${this.name}/`,""));return t}Clear(){this.List().forEach((e=>{this.Remove(e)}))}}var a=__webpack_require__(462);class d extends e.Vb{constructor(){super(...arguments),this.name="Mod Loader",this.description="A mod that loads mods",this.version="0.0.1",this.namespace="modloader",this.logger=e.Cy.GetMod("mblogger").CreateLogger("modloader")}init(){this.logger.info("Loading mods...");let t=e.Cy.GetMod("storage").GetStorage("mods"),o=t.List(),r=o.map((e=>t.Get(e))),i=[];r.forEach(((e,t)=>{e.startsWith("//@modloader-priority")&&i.push(t)})),this.logger.info(`Found ${t.List().length} mods`);for(let t of i)this.logger.info(`Loading prioritized mod ${o[t]}`),e.Cy.LoadMod(o[t]),o.splice(t,1);for(let o=0;o<t.List().length;o++){let r=t.List()[o],i=t.Get(r);this.logger.info(`Loading ${i}`);let s=e.Cy.FilterMods("loader-"),n=!1;for(let t of s)if(t.CanLoad(r)){this.logger.info(`Loading mod ${r} with loader ${t.name}`),e.Cy.LoadMod(t.Load(i)),this.logger.info(`Loaded ${r}`),n=!0;break}n||this.logger.error(`Could not load mod ${r}: no loader found for it`)}this.logger.info(`${e.Cy.GetMods().length} Mods loaded`)}}setTimeout((()=>{window.modbox.ModAPI.LoadMod(t),window.modbox.ModAPI.LoadMod(r),window.modbox.ModAPI.LoadMod(s),window.modbox.ModAPI.LoadMod(a.Z),window.modbox.ModAPI.LoadMod(d)}),500)})(),__webpack_exports__})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU9sTCxRQUM5RCxhQUFla0wsRUFBTzlLLEtBQUsrRCxJQUMzQnZELEtBQUtpSCxPQUFPSixLQUFLLFVBQVV1RCxLQUMzQnRILEdBQVMsRUFDVCxNQUdIQSxHQUNEOUMsS0FBS2lILE9BQU9GLE1BQU0sc0JBQXNCcUQsNkJBR2hEcEssS0FBS2lILE9BQU9KLEtBQUssR0FBRyxlQUFpQmhGLHVCQU03Q3lDLFlBQVcsS0FFUGxDLE9BQU9tSSxPQUFPM0YsT0FBT3RCLFFBQVEyQyxHQUU3QjdELE9BQU9tSSxPQUFPM0YsT0FBT3RCLFFBQVEwRCxHQUU3QjVFLE9BQU9tSSxPQUFPM0YsT0FBT3RCLFFBQVE0RixHQUU3QjlHLE9BQU9tSSxPQUFPM0YsT0FBT3RCLFFBQVEsS0FFN0JsQixPQUFPbUksT0FBTzNGLE9BQU90QixRQUFRMEcsS0FDOUIsTSIsInNvdXJjZXMiOlsid2VicGFjazovL21vZGJveC93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL2xvYWRlci1qcy50cyIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvZXZlbnRzLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy91dGlsLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9tb2RhcGkudHMiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21vZGJveC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL21ibG9nZ2VyLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9ybXRyb2xsYm94LnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9tb2RzdG9yYWdlLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJtb2Rib3hcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wibW9kYm94XCJdID0gZmFjdG9yeSgpO1xufSkoc2VsZiwgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiaW1wb3J0IHsgTW9kIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvYWRlck1vZCBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJKYXZhU2NyaXB0IExvYWRlclwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlRoZSBkZWZhdWx0IGxvYWRlciBmb3IgbW9kYm94LlwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibG9hZGVyLWpzXCI7XHJcbiAgICBMb2FkKGRhdGE6IHN0cmluZyk6IE1vZCB7XHJcbiAgICAgICAgcmV0dXJuIGV2YWwoYChmdW5jdGlvbigpe3JldHVybiAke2RhdGF9fSkoKTtgKSBhcyBNb2Q7XHJcbiAgICB9XHJcbiAgICBDYW5Mb2FkKGZpbGU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBmaWxlLmVuZHNXaXRoKFwiLmpzXCIpO1xyXG4gICAgfVxyXG59IiwiaW50ZXJmYWNlIGNhbGxiYWNrZHVjIHtcclxuICAgIFtrZXk6IHN0cmluZ106IEZ1bmN0aW9uW107XHJcbn1cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRFbWl0dGVyIHtcclxuICAgIHB1YmxpYyBfY2FsbGJhY2tzOiBjYWxsYmFja2R1YztcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHt9O1xyXG4gICAgfVxyXG4gICAgb24oZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0pIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdID0gW107XHJcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0ucHVzaChjYWxsYmFjayk7XHJcbiAgICB9XHJcbiAgICBvZmYoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0pIHJldHVybjtcclxuICAgICAgICB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXS5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBjYWxsYmFjaykgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgb25jZShldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5vbihldmVudE5hbWUsICguLi5kOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhkKTtcclxuICAgICAgICAgICAgdGhpcy5vZmYoZXZlbnROYW1lLCBhcmd1bWVudHMuY2FsbGVlKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgZW1pdChldmVudE5hbWU6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0uZm9yRWFjaCh4ID0+IHgoLi4uYXJncykpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjbGFzcyBFdmVudCB7XHJcbiAgICBwdWJsaWMgZGVmYXVsdFByZXZlbnRlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZywgcHVibGljIGRhdGE6IGFueSwgcHVibGljIGRlZmF1bHRhY3Rpb246IEZ1bmN0aW9uKSB7fTtcclxuICAgIHByZXZlbnREZWZhdWx0KCkge1xyXG4gICAgICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBydW5fZGVmYXVsdCguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGlmICghdGhpcy5kZWZhdWx0UHJldmVudGVkKSB0aGlzLmRlZmF1bHRhY3Rpb24oLi4uYXJncyk7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcikge3JldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKX07XHJcbmV4cG9ydCBuYW1lc3BhY2UgYXJyYXkge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGRlZXBDbG9uZShhcnI6IGFueVtdKTogYW55W10ge1xyXG4gICAgICAgIGxldCBuZXdhcnI6IGFueVtdID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBhcnJbaV07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIikgZGF0YSA9IG9iamVjdC5kZWVwQ2xvbmUoZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSBkYXRhID0gZGVlcENsb25lKGRhdGEpO1xyXG4gICAgICAgICAgICBuZXdhcnIucHVzaChkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ld2FycjtcclxuICAgIH07XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gcmVtb3ZlKGluZGV4OiBudW1iZXIsIGFycjogYW55W10pe1xyXG4gICAgICAgIHJldHVybiBhcnIuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgbmFtZXNwYWNlIG9iamVjdCB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gaGFzRnVuY3Rpb25zKG9iajogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yIChsZXQgaXRlbSBpbiBvYmopIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbaXRlbV0gPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqW2l0ZW1dID09PSBcIm9iamVjdFwiKSByZXR1cm4gaGFzRnVuY3Rpb25zKG9ialtpdGVtXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBkZWVwQ2xvbmUob2JqOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIGlmICgod2luZG93IGFzIGFueSkuc3RydWN0dXJlZENsb25lKSByZXR1cm4gKHdpbmRvdyBhcyBhbnkpLnN0cnVjdHVyZWRDbG9uZShvYmopXHJcbiAgICAgICAgaWYgKCFoYXNGdW5jdGlvbnMob2JqKSkgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7XHJcbiAgICAgICAgbGV0IG5ld29iajogYW55ID0ge307XHJcbiAgICAgICAgZm9yIChsZXQgaXRlbSBpbiBvYmopIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbaXRlbV0gPT09IFwib2JqZWN0XCIpIHtuZXdvYmpbaXRlbV0gPSBkZWVwQ2xvbmUob2JqW2l0ZW1dKTsgY29udGludWV9XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG9ialtpdGVtXSkpIHtuZXdvYmpbaXRlbV0gPSBhcnJheS5kZWVwQ2xvbmUob2JqW2l0ZW1dKTsgY29udGludWV9XHJcbiAgICAgICAgICAgIG5ld29ialtpdGVtXSA9IG9ialtpdGVtXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgRXZlbnRFbWl0dGVyLCB7IEV2ZW50IH0gZnJvbSBcIi4vZXZlbnRzXCI7XHJcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlsJztcclxubGV0IHdpbm8gPSB3aW5kb3cgYXMgYW55O1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJubyBuYW1lXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwibm8gZGVzY3JpcHRpb25cIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4wXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIm1vZFwiO1xyXG4gICAgaW5pdCgpIHt9XHJcbn1cclxuZXhwb3J0IGNsYXNzIE1vZEFQSV9DIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1vZEFQSVwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIkEgQVBJIGZvciBybXRyb2xsYm94IG1vZHNcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIm1vZGFwaVwiO1xyXG4gICAgcHJpdmF0ZSBsb2FkZWQ6IE1vZFtdID0gW107XHJcbiAgICBwcml2YXRlIGhvb2tzOiB7W2tleTogc3RyaW5nXTogRXZlbnRFbWl0dGVyfSA9IHt9O1xyXG4gICAgcHVibGljIEdldE1vZDxUPihuYW1lc3BhY2U6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBhID0gdGhpcy5sb2FkZWQuZmluZCh4ID0+IHgubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpO1xyXG4gICAgICAgIGlmICghYSkgdGhyb3cgbmV3IEVycm9yKGBNb2Qgd2l0aCBuYW1lc3BhY2UgJHtuYW1lc3BhY2V9IG5vdCBmb3VuZC5gKTtcclxuICAgICAgICByZXR1cm4gYSBhcyB1bmtub3duIGFzIFQ7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgR2V0TW9kQnlOYW1lKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRlZC5maW5kKHggPT4geC5uYW1lID09PSBuYW1lKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBHZXRNb2RzKCk6IE1vZFtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZWQ7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgTG9hZE1vZChtb2Q6IGFueSkge1xyXG4gICAgICAgIGxldCBsbW9kOiBNb2QgPSBuZXcgbW9kKCk7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGVkLmZpbmQoeCA9PiB4Lm5hbWUgPT09IGxtb2QubmFtZSkpIHJldHVybjtcclxuICAgICAgICB0aGlzLmxvYWRlZC5wdXNoKGxtb2QpO1xyXG4gICAgICAgIGxtb2QuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIFJlcGxhY2VNb2QobW9kOiBNb2QsIG5ld21vZDogTW9kKSB7XHJcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5sb2FkZWQuZmluZEluZGV4KHggPT4geC5uYW1lID09PSBtb2QubmFtZSk7XHJcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMubG9hZGVkW2luZGV4XSA9IG5ld21vZDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBIb29rKGZ1bmN0aW9uX25hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzLmhvb2tzW2Z1bmN0aW9uX25hbWVdKSByZXR1cm4gdGhpcy5ob29rc1tmdW5jdGlvbl9uYW1lXTtcclxuICAgICAgICBsZXQgZXZlbSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgICAgICBsZXQgb2dmdW5jID0gd2lub1tmdW5jdGlvbl9uYW1lXTtcclxuICAgICAgICB3aW5vW2Z1bmN0aW9uX25hbWVdID0gKGFzeW5jIGZ1bmN0aW9uIChvZ2Z1bmM6IEZ1bmN0aW9uLCAuLi5mYXJnczogYW55W10pIHtcclxuICAgICAgICAgICAgbGV0IG5hcmdzID0gdXRpbC5hcnJheS5kZWVwQ2xvbmUoZmFyZ3MpO1xyXG4gICAgICAgICAgICBldmVtLmVtaXQoJ2JlZm9yZV9jYWxsJywgbmFyZ3MpOyAvLyB5b3UgY2FuIHVzZSBiZWZvcmUgY2FsbCB0byBxdWlja2x5IG1vZGlmeSB0aGUgYXJndW1lbnRzXHJcbiAgICAgICAgICAgIGxldCBmZXZlbnQgPSBuZXcgRXZlbnQoJ2hvb2tlZF9mdW5jdGlvbl9jYWxsJywge2Z1bmNhcmdzOiBuYXJnc30sIG9nZnVuYyk7XHJcbiAgICAgICAgICAgIGV2ZW0uZW1pdCgnY2FsbCcsZmV2ZW50KTtcclxuICAgICAgICAgICAgYXdhaXQgdXRpbC5zbGVlcCg4MCk7XHJcbiAgICAgICAgICAgIGZldmVudC5ydW5fZGVmYXVsdCguLi5uYXJncyk7XHJcbiAgICAgICAgICAgIGV2ZW0uZW1pdChcImFmdGVyX2NhbGxcIik7XHJcbiAgICAgICAgfSkuYmluZCh0aGlzLCBvZ2Z1bmMpO1xyXG4gICAgICAgIHRoaXMuaG9va3NbZnVuY3Rpb25fbmFtZV0gPSBldmVtO1xyXG4gICAgICAgIHJldHVybiBldmVtO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEZpbHRlck1vZHM8VD4ocHJlZml4OiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZWQuZmlsdGVyKHggPT4geC5uYW1lc3BhY2Uuc3RhcnRzV2l0aChwcmVmaXgpKSBhcyB1bmtub3duIGFzIFRbXTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY29uc3QgTW9kQVBJID0gbmV3IE1vZEFQSV9DKCk7IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJpbXBvcnQgeyBNb2QgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTUJMb2dnZXIgZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwiTUJMb2dnZXJcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJUaGUgZGVmYXVsdCBsb2dnZXIgZm9yIG1vZGJveC5cIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIm1ibG9nZ2VyXCI7XHJcbiAgICBwdWJsaWMgaW5pdCgpIHt9XHJcbiAgICBwdWJsaWMgQ3JlYXRlTG9nZ2VyKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBuZXcgTG9nZ2VyKG5hbWUpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZykge31cclxuICAgIHByaXZhdGUgZ2V0VGltZSgpIHtcclxuICAgICAgICBsZXQgZCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbGV0IGhvdXIgPSBkLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgICAgICAgbGV0IG1pbnV0ZSA9IGQuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xyXG4gICAgICAgIGxldCBzZWNvbmQgPSBkLmdldFNlY29uZHMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuICAgICAgICByZXR1cm4gYCR7aG91cn06JHttaW51dGV9OiR7c2Vjb25kfWA7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgbG9nKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFske3RoaXMuZ2V0VGltZSgpfV0gWyR7dGhpcy5uYW1lfV1gLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBpbmZvKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dIFtJTkZPXWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHdhcm4oLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oYFske3RoaXMuZ2V0VGltZSgpfV0gWyR7dGhpcy5uYW1lfV0gW1dBUk5dYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZXJyb3IoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0aGlzLmdldFRpbWUoKX1dIFske3RoaXMubmFtZX1dIFtFUlJPUl1gLCAuLi5hcmdzKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IE1vZCwgTW9kQVBJIH0gZnJvbSBcIi4vbW9kYXBpXCI7XHJcbmltcG9ydCBNQkxvZ2dlciBmcm9tIFwiLi9tYmxvZ2dlclwiO1xyXG5pbXBvcnQgRXZlbnRFbWl0dGVyLCB7RXZlbnR9IGZyb20gXCIuL2V2ZW50c1wiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBybU1lc3NhZ2Uge1xyXG4gICAgbmljazogc3RyaW5nO1xyXG4gICAgaG9tZTogc3RyaW5nO1xyXG4gICAgbXNnOiBzdHJpbmc7XHJcbiAgICBkYXRlOiBudW1iZXI7XHJcbiAgICBjb2xvcjogc3RyaW5nO1xyXG59XHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWFuZCB7XHJcbiAgICBuYW1lc3BhY2U6IHN0cmluZztcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgICB1c2FnZTogc3RyaW5nO1xyXG4gICAgYWxpYXNlczogc3RyaW5nW107XHJcbiAgICBleGVjdXRlOiAoYXJnczogc3RyaW5nW10pID0+IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIHJtdHJvbGxib3ggZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwicm10cm9sbGJveFwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcInJtdHJvbGxib3ggQVBJXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJybXRyb2xsYm94XCI7XHJcbiAgICBwdWJsaWMgbG9nZ2VyID0gTW9kQVBJLkdldE1vZDxNQkxvZ2dlcj4oXCJtYmxvZ2dlclwiKS5DcmVhdGVMb2dnZXIoXCJybXRyb2xsYm94XCIpO1xyXG4gICAgcHJpdmF0ZSByZWdpc3RlcmVkQ29tbWFuZHM6IENvbW1hbmRbXSA9IFtdO1xyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKFwiSW5pdGlhbGl6aW5nIHJtdHJvbGxib3ggQVBJXCIpO1xyXG4gICAgICAgIGxldCBzbmRNc2dIb29rID0gTW9kQVBJLkhvb2soXCJzZW5kTXNnXCIpO1xyXG4gICAgICAgIHNuZE1zZ0hvb2sub24oXCJjYWxsXCIsIChldjogRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgbGV0IG1zZyA9IGV2LmRhdGEuZnVuY2FyZ3NbMF07XHJcbiAgICAgICAgICAgIGlmIChtc2cuc3RhcnRzV2l0aCgnLycpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYXJncyA9IG1zZy5zdWJzdHIoMSkuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgICAgIGxldCBjbWQgPSBhcmdzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmFtZXNwYWNlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIGlmIChjbWQuaW5jbHVkZXMoJzonKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZSA9IGNtZC5zcGxpdCgnOicpWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNtZCA9IGNtZC5zcGxpdCgnOicpWzFdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IGNtZHMgPSB0aGlzLnJlZ2lzdGVyZWRDb21tYW5kcy5maWx0ZXIoYyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVzcGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSAmJiAoYy5uYW1lID09PSBjbWQgfHwgYy5hbGlhc2VzLmluY2x1ZGVzKGNtZCkpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMubmFtZSA9PSBjbWQgfHwgYy5hbGlhc2VzLmluY2x1ZGVzKGNtZClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChjbWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNtZHNbMF0uZXhlY3V0ZShhcmdzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcInJtdHJvbGxib3ggYXBpIGluaXRpYWxpemVkXCIpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIFByaW50TWVzc2FnZShtc2c6IHJtTWVzc2FnZSkge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIHdpbmRvdy5wcmludE1zZyhtc2cpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIFJlZ2lzdGVyQ29tbWFuZChjbWQ6IENvbW1hbmQpIHtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyZWRDb21tYW5kcy5wdXNoKGNtZCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgR2V0RWxlbWVudCh1aWVsZW1lbnQ6IFVJRWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjdHJvbGxib3ggPiAke3VpZWxlbWVudC5HZXRTZWxlY3RvcigpfWApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIE9wZW5Qb3B1cChodG1sOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB3aW5kb3cucG9wdXAoaHRtbCxyZXNvbHZlKTsgLy8gcmVzb2x2ZSBnZXRzIGNhbGxlZCB3aGVuIHRoZSBwb3B1cCBpcyBvcGVuXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG5jbGFzcyBVSUVsZW1lbnQge1xyXG4gICAgcHJpdmF0ZSBfY2hpbGRyZW46IFVJRWxlbWVudFtdID0gW107XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCBwdWJsaWMgZWxlbWVudDogc3RyaW5nKSB7fVxyXG4gICAgcHVibGljIEdldFNlbGVjdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgU2V0Q2hpbGRyZW4oY2hpbGRzOiBVSUVsZW1lbnRbXSkge1xyXG4gICAgICAgIHRoaXMuX2NoaWxkcmVuID0gY2hpbGRzLm1hcCh4ID0+IHtcclxuICAgICAgICAgICAgeC5lbGVtZW50ID0gYCR7dGhpcy5lbGVtZW50fSA+ICR7eC5lbGVtZW50fWA7XHJcbiAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldChuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYSA9IHRoaXMuX2NoaWxkcmVuLmZpbmQoeCA9PiB4Lm5hbWUgPT09IG5hbWUpO1xyXG4gICAgICAgIGlmICghYSkgdGhyb3cgbmV3IEVycm9yKGBObyBjaGlsZCBuYW1lZCAke25hbWV9YCk7XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICB9XHJcbiAgICBnZXQgY2hpbGRyZW4oKToge1trZXk6IHN0cmluZ106IFVJRWxlbWVudH0ge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5fY2hpbGRyZW4ubWFwKHggPT4gW3gubmFtZSwgeF0pKVxyXG4gICAgfVxyXG59XHJcbi8qZXhwb3J0IGNvbnN0IFVJID0ge1xyXG4gICAgRm9ybToge1xyXG4gICAgICAgIF9fY29tYmluZTogXCIjdHJvbGxib3hfZm9ybVwiLFxyXG4gICAgICAgIGdldCBJbnB1dCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX19jb21iaW5lfSA+IHRleHRhcmVhI3Ryb2xsYm94X2lucHV0YDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBTZW5kQnV0dG9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gYnV0dG9uYDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBOaWNrQnV0dG9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gYnV0dG9uI3Ryb2xsYm94X25pY2tfYnRuYDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldCBVcGxvYWRCdXR0b24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9fY29tYmluZX0gPiBidXR0b24jdHJvbGxib3hfdXBsb2FkX2J0bmA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Ki9cclxuZXhwb3J0IGNvbnN0IFVJID0ge1xyXG4gICAgRm9ybTogbmV3IFVJRWxlbWVudChcIkZvcm1cIiwgXCIjdHJvbGxib3hfZm9ybVwiKS5TZXRDaGlsZHJlbihbXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIklucHV0XCIsIFwidGV4dGFyZWEjdHJvbGxib3hfaW5wdXRcIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIlNlbmRCdXR0b25cIiwgXCJidXR0b25cIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIk5pY2tCdXR0b25cIiwgXCJidXR0b24jdHJvbGxib3hfbmlja19idG5cIiksXHJcbiAgICAgICAgbmV3IFVJRWxlbWVudChcIlVwbG9hZEJ1dHRvblwiLCBcImJ1dHRvbiN0cm9sbGJveF91cGxvYWRfYnRuXCIpXHJcblxyXG4gICAgXSlcclxufVxyXG4iLCJpbXBvcnQgeyBNb2QgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kU3RvcmFnZSBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNb2RTdG9yYWdlXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiQSBtb2QgdGhhdCBzdG9yZXMgbW9kIGRhdGFcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcInN0b3JhZ2VcIjtcclxuICAgIHB1YmxpYyBpbml0KCkge31cclxuICAgIHB1YmxpYyBHZXRTdG9yYWdlKG5hbWU6IHN0cmluZyk6IFN0b3JhZ2VEYXRhIHtcclxuICAgICAgICByZXR1cm4gbmV3IFN0b3JhZ2VEYXRhKG5hbWUpO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIFN0b3JhZ2VEYXRhIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcpIHt9XHJcbiAgICBwdWJsaWMgR2V0KGtleTogc3RyaW5nKTogYW55IHtcclxuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYCR7dGhpcy5uYW1lfS8ke2tleX1gKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBTZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHt0aGlzLm5hbWV9LyR7a2V5fWAsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZW1vdmUoa2V5OiBzdHJpbmcpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgJHt0aGlzLm5hbWV9LyR7a2V5fWApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIExpc3QoKSB7XHJcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xyXG4gICAgICAgIGxldCBtb2RzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlzW2ldLnN0YXJ0c1dpdGgodGhpcy5uYW1lK1wiL1wiKSkge1xyXG4gICAgICAgICAgICAgICAgbW9kcy5wdXNoKGtleXNbaV0ucmVwbGFjZShgJHt0aGlzLm5hbWV9L2AsIFwiXCIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbW9kcztcclxuICAgIH1cclxuICAgIHB1YmxpYyBDbGVhcigpIHtcclxuICAgICAgICB0aGlzLkxpc3QoKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuUmVtb3ZlKGtleSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBNb2RBUEksIE1vZCwgTW9kQVBJX0MgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuaW1wb3J0IE1CTG9nZ2VyIGZyb20gXCIuL21ibG9nZ2VyXCI7XHJcbmltcG9ydCBybXRyb2xsYm94IGZyb20gXCIuL3JtdHJvbGxib3hcIjtcclxuaW1wb3J0IE1vZFN0b3JhZ2UgZnJvbSBcIi4vbW9kc3RvcmFnZVwiO1xyXG5pbXBvcnQgTG9hZGVyTW9kIGZyb20gXCIuL2xvYWRlci1qc1wiO1xyXG5cclxuY2xhc3MgTW9kTG9hZGVyIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1vZCBMb2FkZXJcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJBIG1vZCB0aGF0IGxvYWRzIG1vZHNcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcIm1vZGxvYWRlclwiO1xyXG4gICAgcHJpdmF0ZSBsb2dnZXIgPSBNb2RBUEkuR2V0TW9kPE1CTG9nZ2VyPihcIm1ibG9nZ2VyXCIpLkNyZWF0ZUxvZ2dlcihcIm1vZGxvYWRlclwiKTtcclxuICAgIHB1YmxpYyBpbml0KCkge1xyXG4gICAgICAgIC8qLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93Lk1vZEFQSSA9IE1vZEFQSTsgLy8gZXhwb3NlIHRoZSBNb2RBUEkgdG8gdGhlIHdpbmRvd1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ01vZEFQSSBleHBvc2VkIHRvIHdpbmRvdycpO1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIHdpbmRvdy5Nb2QgPSBNb2Q7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnTW9kIGNsYXNzIGV4cG9zZWQgdG8gd2luZG93Jyk7Ki9cclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdMb2FkaW5nIG1vZHMuLi4nKTtcclxuICAgICAgICBsZXQgbW9kcyA9IE1vZEFQSS5HZXRNb2Q8TW9kU3RvcmFnZT4oXCJzdG9yYWdlXCIpLkdldFN0b3JhZ2UoXCJtb2RzXCIpXHJcbiAgICAgICAgbGV0IG1vZExpc3QgPSBtb2RzLkxpc3QoKTtcclxuICAgICAgICBsZXQgbW9kVGV4dCA9IG1vZExpc3QubWFwKHggPT4gbW9kcy5HZXQoeCkpO1xyXG4gICAgICAgIGxldCBwcmlvcml0eU1vZHM6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgbW9kVGV4dC5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJy8vQG1vZGxvYWRlci1wcmlvcml0eScpKSB7XHJcbiAgICAgICAgICAgICAgICBwcmlvcml0eU1vZHMucHVzaChpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYEZvdW5kICR7bW9kcy5MaXN0KCkubGVuZ3RofSBtb2RzYCk7XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggb2YgcHJpb3JpdHlNb2RzKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYExvYWRpbmcgcHJpb3JpdGl6ZWQgbW9kICR7bW9kTGlzdFtpbmRleF19YCk7XHJcbiAgICAgICAgICAgIE1vZEFQSS5Mb2FkTW9kKG1vZExpc3RbaW5kZXhdKTtcclxuICAgICAgICAgICAgbW9kTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vZHMuTGlzdCgpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBtb2ROYW1lID0gbW9kcy5MaXN0KClbaV1cclxuICAgICAgICAgICAgbGV0IG1vZCA9IG1vZHMuR2V0KG1vZE5hbWUpXHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYExvYWRpbmcgJHttb2R9YCk7XHJcbiAgICAgICAgICAgIGxldCBsb2FkZXJzID0gTW9kQVBJLkZpbHRlck1vZHM8TG9hZGVyTW9kPihcImxvYWRlci1cIik7XHJcbiAgICAgICAgICAgIGxldCBsb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yIChsZXQgbG9hZGVyIG9mIGxvYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsb2FkZXIuQ2FuTG9hZChtb2ROYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYExvYWRpbmcgbW9kICR7bW9kTmFtZX0gd2l0aCBsb2FkZXIgJHtsb2FkZXIubmFtZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICBNb2RBUEkuTG9hZE1vZChsb2FkZXIuTG9hZChtb2QpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKGBMb2FkZWQgJHttb2ROYW1lfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFsb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBDb3VsZCBub3QgbG9hZCBtb2QgJHttb2ROYW1lfTogbm8gbG9hZGVyIGZvdW5kIGZvciBpdGApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYCR7TW9kQVBJLkdldE1vZHMoKS5sZW5ndGh9IE1vZHMgbG9hZGVkYCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IE1vZCwgTW9kQVBJLCBNb2RBUElfQyB9O1xyXG5cclxuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIHdpbmRvdy5tb2Rib3guTW9kQVBJLkxvYWRNb2QoTUJMb2dnZXIpO1xyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICB3aW5kb3cubW9kYm94Lk1vZEFQSS5Mb2FkTW9kKHJtdHJvbGxib3gpO1xyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICB3aW5kb3cubW9kYm94Lk1vZEFQSS5Mb2FkTW9kKE1vZFN0b3JhZ2UpO1xyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICB3aW5kb3cubW9kYm94Lk1vZEFQSS5Mb2FkTW9kKExvYWRlck1vZCk7XHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIHdpbmRvdy5tb2Rib3guTW9kQVBJLkxvYWRNb2QoTW9kTG9hZGVyKTtcclxufSwgNTAwKVxyXG4iXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwic2VsZiIsIkxvYWRlck1vZCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInZlcnNpb24iLCJuYW1lc3BhY2UiLCJMb2FkIiwiZGF0YSIsImV2YWwiLCJDYW5Mb2FkIiwiZmlsZSIsImVuZHNXaXRoIiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiX2NhbGxiYWNrcyIsIm9uIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJwdXNoIiwib2ZmIiwiZm9yRWFjaCIsInZhbHVlIiwiaW5kZXgiLCJzcGxpY2UiLCJvbmNlIiwiZCIsImFyZ3VtZW50cyIsImNhbGxlZSIsImVtaXQiLCJhcmdzIiwieCIsIkV2ZW50IiwiZGVmYXVsdGFjdGlvbiIsImRlZmF1bHRQcmV2ZW50ZWQiLCJwcmV2ZW50RGVmYXVsdCIsInJ1bl9kZWZhdWx0IiwiYXJyYXkiLCJvYmplY3QiLCJkZWVwQ2xvbmUiLCJhcnIiLCJuZXdhcnIiLCJpIiwibGVuZ3RoIiwiQXJyYXkiLCJpc0FycmF5IiwicmVtb3ZlIiwiaGFzRnVuY3Rpb25zIiwib2JqIiwiaXRlbSIsIndpbmRvdyIsInN0cnVjdHVyZWRDbG9uZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIm5ld29iaiIsIndpbm8iLCJNb2QiLCJpbml0IiwiTW9kQVBJX0MiLCJsb2FkZWQiLCJob29rcyIsIkdldE1vZCIsImEiLCJmaW5kIiwiRXJyb3IiLCJHZXRNb2RCeU5hbWUiLCJHZXRNb2RzIiwiTG9hZE1vZCIsIm1vZCIsImxtb2QiLCJSZXBsYWNlTW9kIiwibmV3bW9kIiwiZmluZEluZGV4IiwiSG9vayIsImZ1bmN0aW9uX25hbWUiLCJldmVtIiwib2dmdW5jIiwiZmFyZ3MiLCJuYXJncyIsImZldmVudCIsImZ1bmNhcmdzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiYmluZCIsIkZpbHRlck1vZHMiLCJwcmVmaXgiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiTW9kQVBJIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsIk1CTG9nZ2VyIiwiQ3JlYXRlTG9nZ2VyIiwiTG9nZ2VyIiwiZ2V0VGltZSIsIkRhdGUiLCJnZXRIb3VycyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsImxvZyIsImNvbnNvbGUiLCJpbmZvIiwid2FybiIsImVycm9yIiwicm10cm9sbGJveCIsImxvZ2dlciIsInJlZ2lzdGVyZWRDb21tYW5kcyIsImV2IiwibXNnIiwic3Vic3RyIiwic3BsaXQiLCJjbWQiLCJzaGlmdCIsImluY2x1ZGVzIiwiY21kcyIsImMiLCJhbGlhc2VzIiwiZXhlY3V0ZSIsIlByaW50TWVzc2FnZSIsInByaW50TXNnIiwiUmVnaXN0ZXJDb21tYW5kIiwiR2V0RWxlbWVudCIsInVpZWxlbWVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIkdldFNlbGVjdG9yIiwiT3BlblBvcHVwIiwiaHRtbCIsInBvcHVwIiwiVUlFbGVtZW50IiwiZWxlbWVudCIsIl9jaGlsZHJlbiIsIlNldENoaWxkcmVuIiwiY2hpbGRzIiwibWFwIiwiR2V0IiwiY2hpbGRyZW4iLCJmcm9tRW50cmllcyIsIk1vZFN0b3JhZ2UiLCJHZXRTdG9yYWdlIiwiU3RvcmFnZURhdGEiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiU2V0Iiwic2V0SXRlbSIsIlJlbW92ZSIsInJlbW92ZUl0ZW0iLCJMaXN0Iiwia2V5cyIsIm1vZHMiLCJyZXBsYWNlIiwiQ2xlYXIiLCJNb2RMb2FkZXIiLCJtb2RMaXN0IiwibW9kVGV4dCIsInByaW9yaXR5TW9kcyIsIm1vZE5hbWUiLCJsb2FkZXJzIiwibG9hZGVyIiwibW9kYm94Il0sInNvdXJjZVJvb3QiOiIifQ==