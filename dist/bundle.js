!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.modbox=t():e.modbox=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>LoaderMod});var _modapi__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(791);class LoaderMod extends _modapi__WEBPACK_IMPORTED_MODULE_0__.Vb{constructor(){super(...arguments),this.name="JavaScript Loader",this.description="The default loader for modbox.",this.version="0.0.1",this.namespace="loader-js"}Load(data){return eval(`(function(){return ${data}})();`)}CanLoad(e){return e.endsWith(".js")}}},791:(e,t,o)=>{o.d(t,{Vb:()=>l,Cy:()=>c,M5:()=>d});class r{constructor(){this._callbacks={}}on(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}off(e,t){this._callbacks[e]&&this._callbacks[e].forEach(((o,r)=>{o===t&&this._callbacks[e].splice(r,1)}))}once(e,t){this.on(e,((...o)=>{t(o),this.off(e,arguments.callee)}))}emit(e,...t){this._callbacks[e]&&this._callbacks[e].forEach((e=>e(...t)))}}class i{constructor(e,t,o){this.name=e,this.data=t,this.defaultaction=o,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}run_default(...e){this.defaultPrevented||this.defaultaction(...e)}}var s,n;!function(e){e.deepClone=function e(t){let o=[];for(let r=0;r<t.length;r++){let i=t[r];"object"==typeof i&&(i=n.deepClone(i)),Array.isArray(i)&&(i=e(i)),o.push(i)}return o},e.remove=function(e,t){return t.splice(e,1)}}(s||(s={})),function(e){function t(e){for(let o in e){if("function"==typeof e[o])return!0;if("object"==typeof e[o])return t(e[o])}return!1}e.hasFunctions=t,e.deepClone=function e(o){if(window.structuredClone)return window.structuredClone(o);if(!t(o))return JSON.parse(JSON.stringify(o));let r={};for(let t in o)"object"!=typeof o[t]?Array.isArray(o[t])?r[t]=s.deepClone(o[t]):r[t]=o[t]:r[t]=e(o[t])}}(n||(n={}));let a=window;class l{constructor(){this.name="no name",this.description="no description",this.version="0.0.0",this.namespace="mod"}init(){}}class d extends l{constructor(){super(...arguments),this.name="ModAPI",this.description="A API for rmtrollbox mods",this.version="0.0.1",this.namespace="modapi",this.loaded=[],this.hooks={}}GetMod(e){let t=this.loaded.find((t=>t.namespace===e));if(!t)throw new Error(`Mod with namespace ${e} not found.`);return t}GetModByName(e){return this.loaded.find((t=>t.name===e))}GetMods(){return this.loaded}LoadMod(e){let t=new e;this.loaded.find((e=>e.name===t.name))||(this.loaded.push(t),t.init())}ReplaceMod(e,t){let o=this.loaded.findIndex((t=>t.name===e.name));-1!==o&&(this.loaded[o]=t)}Hook(e){if(this.hooks[e])return this.hooks[e];let t=new r,o=a[e];return a[e]=async function(e,...o){let r=s.deepClone(o);t.emit("before_call",r);let n=new i("hooked_function_call",{funcargs:r},e);t.emit("call",n),await(80,new Promise((e=>setTimeout(e,80)))),n.run_default(...r),t.emit("after_call")}.bind(this,o),this.hooks[e]=t,t}FilterMods(e){return this.loaded.filter((t=>t.namespace.startsWith(e)))}}const c=new d}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Mod:()=>e.Vb,ModAPI:()=>e.Cy,ModAPI_C:()=>e.M5});var e=__webpack_require__(791);class t extends e.Vb{constructor(){super(...arguments),this.name="MBLogger",this.description="The default logger for modbox.",this.version="0.0.1",this.namespace="mblogger"}init(){}CreateLogger(e){return new o(e)}}class o{constructor(e){this.name=e}getTime(){let e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`}log(...e){console.log(`[${this.getTime()}] [${this.name}]`,...e)}info(...e){console.info(`[${this.getTime()}] [${this.name}] [INFO]`,...e)}warn(...e){console.warn(`[${this.getTime()}] [${this.name}] [WARN]`,...e)}error(...e){console.error(`[${this.getTime()}] [${this.name}] [ERROR]`,...e)}}class r extends e.Vb{constructor(){super(...arguments),this.name="rmtrollbox",this.description="rmtrollbox API",this.version="0.0.1",this.namespace="rmtrollbox",this.logger=e.Cy.GetMod("mblogger").CreateLogger("rmtrollbox"),this.registeredCommands=[]}init(){this.logger.log("Initializing rmtrollbox API"),e.Cy.Hook("sendMsg").on("call",(e=>{let t=e.data.funcargs[0];if(t.startsWith("/")){let o=t.substr(1).split(" "),r=o.shift(),i="";r.includes(":")&&(i=r.split(":")[0],r=r.split(":")[1]);let s=this.registeredCommands.filter((e=>i?e.namespace===i&&(e.name===r||e.aliases.includes(r)):e.name==r||e.aliases.includes(r)));s.length>0&&(e.preventDefault(),s[0].execute(o))}})),this.logger.info("rmtrollbox api initialized")}PrintMessage(e){window.printMsg(e)}RegisterCommand(e){this.registeredCommands.push(e)}GetElement(e){return document.querySelector(`#trollbox > ${e.GetSelector()}`)}OpenPopup(e){return new Promise((t=>{window.popup(e,t)}))}}class i{constructor(e,t){this.name=e,this.element=t,this._children=[]}GetSelector(){return this.element}SetChildren(e){return this._children=e.map((e=>(e.element=`${this.element} > ${e.element}`,e))),this}Get(e){let t=this._children.find((t=>t.name===e));if(!t)throw new Error(`No child named ${e}`);return t}get children(){return Object.fromEntries(this._children.map((e=>[e.name,e])))}}new i("Form","#trollbox_form").SetChildren([new i("Input","textarea#trollbox_input"),new i("SendButton","button"),new i("NickButton","button#trollbox_nick_btn"),new i("UploadButton","button#trollbox_upload_btn")]);class s extends e.Vb{constructor(){super(...arguments),this.name="ModStorage",this.description="A mod that stores mod data",this.version="0.0.1",this.namespace="storage"}init(){}GetStorage(e){return new n(e)}}class n{constructor(e){this.name=e}Get(e){return localStorage.getItem(`${this.name}/${e}`)}Set(e,t){localStorage.setItem(`${this.name}/${e}`,t)}Remove(e){localStorage.removeItem(`${this.name}/${e}`)}List(){let e=Object.keys(localStorage),t=[];for(let o=0;o<e.length;o++)e[o].startsWith(this.name+"/")&&t.push(e[o].replace(`${this.name}/`,""));return t}Clear(){this.List().forEach((e=>{this.Remove(e)}))}}var a=__webpack_require__(462);class l extends e.Vb{constructor(){super(...arguments),this.name="Mod Loader",this.description="A mod that loads mods",this.version="0.0.1",this.namespace="modloader",this.logger=e.Cy.GetMod("mblogger").CreateLogger("modloader")}init(){this.logger.info("Loading mods...");let t=e.Cy.GetMod("storage").GetStorage("mods"),o=t.List(),r=o.map((e=>t.Get(e))),i=[];r.forEach(((e,t)=>{e.startsWith("//@modloader-priority")&&i.push(t)})),this.logger.info(`Found ${t.List().length} mods`);for(let t of i)this.logger.info(`Loading prioritized mod ${o[t]}`),e.Cy.LoadMod(o[t]),o.splice(t,1);for(let o=0;o<t.List().length;o++){let r=t.List()[o],i=t.Get(r);this.logger.info(`Loading ${i}`);let s=e.Cy.FilterMods("loader-"),n=!1;for(let t of s)if(t.CanLoad(r)){this.logger.info(`Loading mod ${i} with loader ${t.name}`),e.Cy.LoadMod(t.Load(i)),this.logger.info(`Loaded ${i}`),n=!0;break}n||this.logger.error(`Could not load mod ${r}: no loader found for it`)}this.logger.info(`${e.Cy.GetMods().length} Mods loaded`)}}e.Cy.LoadMod(t),e.Cy.LoadMod(r),e.Cy.LoadMod(s),e.Cy.LoadMod(a.Z),e.Cy.LoadMod(l)})(),__webpack_exports__})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPbEwsUUFDMUQsYUFBZWtMLEVBQU85SyxLQUFLK0QsSUFDM0J2RCxLQUFLaUgsT0FBT0osS0FBSyxVQUFVdEQsS0FDM0JULEdBQVMsRUFDVCxNQUdIQSxHQUNEOUMsS0FBS2lILE9BQU9GLE1BQU0sc0JBQXNCcUQsNkJBR2hEcEssS0FBS2lILE9BQU9KLEtBQUssR0FBRyxlQUFpQmhGLHVCQUc3QyxhQUFlb0UsR0FDZixhQUFlZSxHQUNmLGFBQWVrQyxHQUNmLGFBQWUsS0FDZixhQUFlYyxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvbG9hZGVyLWpzLnRzIiwid2VicGFjazovL21vZGJveC8uL3NyYy9ldmVudHMudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL3V0aWwudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL21vZGFwaS50cyIsIndlYnBhY2s6Ly9tb2Rib3gvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vbW9kYm94L3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9tb2Rib3gvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9tb2Rib3gvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9tb2Rib3gvLi9zcmMvbWJsb2dnZXIudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL3JtdHJvbGxib3gudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL21vZHN0b3JhZ2UudHMiLCJ3ZWJwYWNrOi8vbW9kYm94Ly4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIm1vZGJveFwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJtb2Rib3hcIl0gPSBmYWN0b3J5KCk7XG59KShzZWxmLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCJpbXBvcnQgeyBNb2QgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9hZGVyTW9kIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIkphdmFTY3JpcHQgTG9hZGVyXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiVGhlIGRlZmF1bHQgbG9hZGVyIGZvciBtb2Rib3guXCI7XHJcbiAgICBwdWJsaWMgdmVyc2lvbjogc3RyaW5nID0gXCIwLjAuMVwiO1xyXG4gICAgcHVibGljIG5hbWVzcGFjZTogc3RyaW5nID0gXCJsb2FkZXItanNcIjtcclxuICAgIExvYWQoZGF0YTogc3RyaW5nKTogTW9kIHtcclxuICAgICAgICByZXR1cm4gZXZhbChgKGZ1bmN0aW9uKCl7cmV0dXJuICR7ZGF0YX19KSgpO2ApIGFzIE1vZDtcclxuICAgIH1cclxuICAgIENhbkxvYWQoZmlsZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIGZpbGUuZW5kc1dpdGgoXCIuanNcIik7XHJcbiAgICB9XHJcbn0iLCJpbnRlcmZhY2UgY2FsbGJhY2tkdWMge1xyXG4gICAgW2tleTogc3RyaW5nXTogRnVuY3Rpb25bXTtcclxufVxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFdmVudEVtaXR0ZXIge1xyXG4gICAgcHVibGljIF9jYWxsYmFja3M6IGNhbGxiYWNrZHVjO1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0ge307XHJcbiAgICB9XHJcbiAgICBvbihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSkgdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0gPSBbXTtcclxuICAgICAgICB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKTtcclxuICAgIH1cclxuICAgIG9mZihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudE5hbWVdLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IGNhbGxiYWNrKSB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBvbmNlKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICB0aGlzLm9uKGV2ZW50TmFtZSwgKC4uLmQ6IGFueVtdKSA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGQpO1xyXG4gICAgICAgICAgICB0aGlzLm9mZihldmVudE5hbWUsIGFyZ3VtZW50cy5jYWxsZWUpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBlbWl0KGV2ZW50TmFtZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzW2V2ZW50TmFtZV0pIHJldHVybjtcclxuICAgICAgICB0aGlzLl9jYWxsYmFja3NbZXZlbnROYW1lXS5mb3JFYWNoKHggPT4geCguLi5hcmdzKSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIEV2ZW50IHtcclxuICAgIHB1YmxpYyBkZWZhdWx0UHJldmVudGVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCBwdWJsaWMgZGF0YTogYW55LCBwdWJsaWMgZGVmYXVsdGFjdGlvbjogRnVuY3Rpb24pIHt9O1xyXG4gICAgcHJldmVudERlZmF1bHQoKSB7XHJcbiAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJ1bl9kZWZhdWx0KC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRlZmF1bHRQcmV2ZW50ZWQpIHRoaXMuZGVmYXVsdGFjdGlvbiguLi5hcmdzKTtcclxuICAgIH1cclxufSIsImV4cG9ydCBmdW5jdGlvbiBzbGVlcChtczogbnVtYmVyKSB7cmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpfTtcclxuZXhwb3J0IG5hbWVzcGFjZSBhcnJheSB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVlcENsb25lKGFycjogYW55W10pOiBhbnlbXSB7XHJcbiAgICAgICAgbGV0IG5ld2FycjogYW55W10gPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IGFycltpXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiKSBkYXRhID0gb2JqZWN0LmRlZXBDbG9uZShkYXRhKTtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIGRhdGEgPSBkZWVwQ2xvbmUoZGF0YSk7XHJcbiAgICAgICAgICAgIG5ld2Fyci5wdXNoKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3YXJyO1xyXG4gICAgfTtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiByZW1vdmUoaW5kZXg6IG51bWJlciwgYXJyOiBhbnlbXSl7XHJcbiAgICAgICAgcmV0dXJuIGFyci5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBuYW1lc3BhY2Ugb2JqZWN0IHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBoYXNGdW5jdGlvbnMob2JqOiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICBmb3IgKGxldCBpdGVtIGluIG9iaikge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9ialtpdGVtXSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbaXRlbV0gPT09IFwib2JqZWN0XCIpIHJldHVybiBoYXNGdW5jdGlvbnMob2JqW2l0ZW1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGRlZXBDbG9uZShvYmo6IGFueSk6IGFueSB7XHJcbiAgICAgICAgaWYgKCh3aW5kb3cgYXMgYW55KS5zdHJ1Y3R1cmVkQ2xvbmUpIHJldHVybiAod2luZG93IGFzIGFueSkuc3RydWN0dXJlZENsb25lKG9iailcclxuICAgICAgICBpZiAoIWhhc0Z1bmN0aW9ucyhvYmopKSByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcclxuICAgICAgICBsZXQgbmV3b2JqOiBhbnkgPSB7fTtcclxuICAgICAgICBmb3IgKGxldCBpdGVtIGluIG9iaikge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9ialtpdGVtXSA9PT0gXCJvYmplY3RcIikge25ld29ialtpdGVtXSA9IGRlZXBDbG9uZShvYmpbaXRlbV0pOyBjb250aW51ZX1cclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqW2l0ZW1dKSkge25ld29ialtpdGVtXSA9IGFycmF5LmRlZXBDbG9uZShvYmpbaXRlbV0pOyBjb250aW51ZX1cclxuICAgICAgICAgICAgbmV3b2JqW2l0ZW1dID0gb2JqW2l0ZW1dO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImltcG9ydCBFdmVudEVtaXR0ZXIsIHsgRXZlbnQgfSBmcm9tIFwiLi9ldmVudHNcIjtcclxuaW1wb3J0ICogYXMgdXRpbCBmcm9tICcuL3V0aWwnO1xyXG5sZXQgd2lubyA9IHdpbmRvdyBhcyBhbnk7XHJcblxyXG5leHBvcnQgY2xhc3MgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIm5vIG5hbWVcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJubyBkZXNjcmlwdGlvblwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjBcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibW9kXCI7XHJcbiAgICBpbml0KCkge31cclxufVxyXG5leHBvcnQgY2xhc3MgTW9kQVBJX0MgZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwiTW9kQVBJXCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwiQSBBUEkgZm9yIHJtdHJvbGxib3ggbW9kc1wiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibW9kYXBpXCI7XHJcbiAgICBwcml2YXRlIGxvYWRlZDogTW9kW10gPSBbXTtcclxuICAgIHByaXZhdGUgaG9va3M6IHtba2V5OiBzdHJpbmddOiBFdmVudEVtaXR0ZXJ9ID0ge307XHJcbiAgICBwdWJsaWMgR2V0TW9kPFQ+KG5hbWVzcGFjZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGEgPSB0aGlzLmxvYWRlZC5maW5kKHggPT4geC5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSk7XHJcbiAgICAgICAgaWYgKCFhKSB0aHJvdyBuZXcgRXJyb3IoYE1vZCB3aXRoIG5hbWVzcGFjZSAke25hbWVzcGFjZX0gbm90IGZvdW5kLmApO1xyXG4gICAgICAgIHJldHVybiBhIGFzIHVua25vd24gYXMgVDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBHZXRNb2RCeU5hbWUobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkLmZpbmQoeCA9PiB4Lm5hbWUgPT09IG5hbWUpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEdldE1vZHMoKTogTW9kW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRlZDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBMb2FkTW9kKG1vZDogYW55KSB7XHJcbiAgICAgICAgbGV0IGxtb2Q6IE1vZCA9IG5ldyBtb2QoKTtcclxuICAgICAgICBpZiAodGhpcy5sb2FkZWQuZmluZCh4ID0+IHgubmFtZSA9PT0gbG1vZC5uYW1lKSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMubG9hZGVkLnB1c2gobG1vZCk7XHJcbiAgICAgICAgbG1vZC5pbml0KCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgUmVwbGFjZU1vZChtb2Q6IE1vZCwgbmV3bW9kOiBNb2QpIHtcclxuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmxvYWRlZC5maW5kSW5kZXgoeCA9PiB4Lm5hbWUgPT09IG1vZC5uYW1lKTtcclxuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5sb2FkZWRbaW5kZXhdID0gbmV3bW9kO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEhvb2soZnVuY3Rpb25fbmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaG9va3NbZnVuY3Rpb25fbmFtZV0pIHJldHVybiB0aGlzLmhvb2tzW2Z1bmN0aW9uX25hbWVdO1xyXG4gICAgICAgIGxldCBldmVtID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgICAgIGxldCBvZ2Z1bmMgPSB3aW5vW2Z1bmN0aW9uX25hbWVdO1xyXG4gICAgICAgIHdpbm9bZnVuY3Rpb25fbmFtZV0gPSAoYXN5bmMgZnVuY3Rpb24gKG9nZnVuYzogRnVuY3Rpb24sIC4uLmZhcmdzOiBhbnlbXSkge1xyXG4gICAgICAgICAgICBsZXQgbmFyZ3MgPSB1dGlsLmFycmF5LmRlZXBDbG9uZShmYXJncyk7XHJcbiAgICAgICAgICAgIGV2ZW0uZW1pdCgnYmVmb3JlX2NhbGwnLCBuYXJncyk7IC8vIHlvdSBjYW4gdXNlIGJlZm9yZSBjYWxsIHRvIHF1aWNrbHkgbW9kaWZ5IHRoZSBhcmd1bWVudHNcclxuICAgICAgICAgICAgbGV0IGZldmVudCA9IG5ldyBFdmVudCgnaG9va2VkX2Z1bmN0aW9uX2NhbGwnLCB7ZnVuY2FyZ3M6IG5hcmdzfSwgb2dmdW5jKTtcclxuICAgICAgICAgICAgZXZlbS5lbWl0KCdjYWxsJyxmZXZlbnQpO1xyXG4gICAgICAgICAgICBhd2FpdCB1dGlsLnNsZWVwKDgwKTtcclxuICAgICAgICAgICAgZmV2ZW50LnJ1bl9kZWZhdWx0KC4uLm5hcmdzKTtcclxuICAgICAgICAgICAgZXZlbS5lbWl0KFwiYWZ0ZXJfY2FsbFwiKTtcclxuICAgICAgICB9KS5iaW5kKHRoaXMsIG9nZnVuYyk7XHJcbiAgICAgICAgdGhpcy5ob29rc1tmdW5jdGlvbl9uYW1lXSA9IGV2ZW07XHJcbiAgICAgICAgcmV0dXJuIGV2ZW07XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgRmlsdGVyTW9kczxUPihwcmVmaXg6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRlZC5maWx0ZXIoeCA9PiB4Lm5hbWVzcGFjZS5zdGFydHNXaXRoKHByZWZpeCkpIGFzIHVua25vd24gYXMgVFtdO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjb25zdCBNb2RBUEkgPSBuZXcgTW9kQVBJX0MoKTsiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCB7IE1vZCB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNQkxvZ2dlciBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJNQkxvZ2dlclwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlRoZSBkZWZhdWx0IGxvZ2dlciBmb3IgbW9kYm94LlwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibWJsb2dnZXJcIjtcclxuICAgIHB1YmxpYyBpbml0KCkge31cclxuICAgIHB1YmxpYyBDcmVhdGVMb2dnZXIobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMb2dnZXIobmFtZSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIExvZ2dlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nKSB7fVxyXG4gICAgcHJpdmF0ZSBnZXRUaW1lKCkge1xyXG4gICAgICAgIGxldCBkID0gbmV3IERhdGUoKTtcclxuICAgICAgICBsZXQgaG91ciA9IGQuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuICAgICAgICBsZXQgbWludXRlID0gZC5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgICAgICAgbGV0IHNlY29uZCA9IGQuZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xyXG4gICAgICAgIHJldHVybiBgJHtob3VyfToke21pbnV0ZX06JHtzZWNvbmR9YDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBsb2coLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGluZm8oLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oYFske3RoaXMuZ2V0VGltZSgpfV0gWyR7dGhpcy5uYW1lfV0gW0lORk9dYCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgd2FybiguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihgWyR7dGhpcy5nZXRUaW1lKCl9XSBbJHt0aGlzLm5hbWV9XSBbV0FSTl1gLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBlcnJvciguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RoaXMuZ2V0VGltZSgpfV0gWyR7dGhpcy5uYW1lfV0gW0VSUk9SXWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgTW9kLCBNb2RBUEkgfSBmcm9tIFwiLi9tb2RhcGlcIjtcclxuaW1wb3J0IE1CTG9nZ2VyIGZyb20gXCIuL21ibG9nZ2VyXCI7XHJcbmltcG9ydCBFdmVudEVtaXR0ZXIsIHtFdmVudH0gZnJvbSBcIi4vZXZlbnRzXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIHJtTWVzc2FnZSB7XHJcbiAgICBuaWNrOiBzdHJpbmc7XHJcbiAgICBob21lOiBzdHJpbmc7XHJcbiAgICBtc2c6IHN0cmluZztcclxuICAgIGRhdGU6IG51bWJlcjtcclxuICAgIGNvbG9yOiBzdHJpbmc7XHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBDb21tYW5kIHtcclxuICAgIG5hbWVzcGFjZTogc3RyaW5nO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICAgIHVzYWdlOiBzdHJpbmc7XHJcbiAgICBhbGlhc2VzOiBzdHJpbmdbXTtcclxuICAgIGV4ZWN1dGU6IChhcmdzOiBzdHJpbmdbXSkgPT4gdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3Mgcm10cm9sbGJveCBleHRlbmRzIE1vZCB7XHJcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJybXRyb2xsYm94XCI7XHJcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyA9IFwicm10cm9sbGJveCBBUElcIjtcclxuICAgIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmcgPSBcIjAuMC4xXCI7XHJcbiAgICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmcgPSBcInJtdHJvbGxib3hcIjtcclxuICAgIHB1YmxpYyBsb2dnZXIgPSBNb2RBUEkuR2V0TW9kPE1CTG9nZ2VyPihcIm1ibG9nZ2VyXCIpLkNyZWF0ZUxvZ2dlcihcInJtdHJvbGxib3hcIik7XHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyZWRDb21tYW5kczogQ29tbWFuZFtdID0gW107XHJcbiAgICBwdWJsaWMgaW5pdCgpIHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coXCJJbml0aWFsaXppbmcgcm10cm9sbGJveCBBUElcIik7XHJcbiAgICAgICAgbGV0IHNuZE1zZ0hvb2sgPSBNb2RBUEkuSG9vayhcInNlbmRNc2dcIik7XHJcbiAgICAgICAgc25kTXNnSG9vay5vbihcImNhbGxcIiwgKGV2OiBFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbXNnID0gZXYuZGF0YS5mdW5jYXJnc1swXTtcclxuICAgICAgICAgICAgaWYgKG1zZy5zdGFydHNXaXRoKCcvJykpIHtcclxuICAgICAgICAgICAgICAgIGxldCBhcmdzID0gbXNnLnN1YnN0cigxKS5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNtZCA9IGFyZ3Muc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIGxldCBuYW1lc3BhY2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNtZC5pbmNsdWRlcygnOicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlID0gY21kLnNwbGl0KCc6JylbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgY21kID0gY21kLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZXQgY21kcyA9IHRoaXMucmVnaXN0ZXJlZENvbW1hbmRzLmZpbHRlcihjID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZXNwYWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlICYmIChjLm5hbWUgPT09IGNtZCB8fCBjLmFsaWFzZXMuaW5jbHVkZXMoY21kKSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5uYW1lID09IGNtZCB8fCBjLmFsaWFzZXMuaW5jbHVkZXMoY21kKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNtZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY21kc1swXS5leGVjdXRlKGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwicm10cm9sbGJveCBhcGkgaW5pdGlhbGl6ZWRcIik7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgUHJpbnRNZXNzYWdlKG1zZzogcm1NZXNzYWdlKSB7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93LnByaW50TXNnKG1zZyk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgUmVnaXN0ZXJDb21tYW5kKGNtZDogQ29tbWFuZCkge1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJlZENvbW1hbmRzLnB1c2goY21kKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBHZXRFbGVtZW50KHVpZWxlbWVudDogVUlFbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN0cm9sbGJveCA+ICR7dWllbGVtZW50LkdldFNlbGVjdG9yKCl9YCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgT3BlblBvcHVwKGh0bWw6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgIHdpbmRvdy5wb3B1cChodG1sLHJlc29sdmUpOyAvLyByZXNvbHZlIGdldHMgY2FsbGVkIHdoZW4gdGhlIHBvcHVwIGlzIG9wZW5cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG59XHJcbmNsYXNzIFVJRWxlbWVudCB7XHJcbiAgICBwcml2YXRlIF9jaGlsZHJlbjogVUlFbGVtZW50W10gPSBbXTtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsIHB1YmxpYyBlbGVtZW50OiBzdHJpbmcpIHt9XHJcbiAgICBwdWJsaWMgR2V0U2VsZWN0b3IoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBTZXRDaGlsZHJlbihjaGlsZHM6IFVJRWxlbWVudFtdKSB7XHJcbiAgICAgICAgdGhpcy5fY2hpbGRyZW4gPSBjaGlsZHMubWFwKHggPT4ge1xyXG4gICAgICAgICAgICB4LmVsZW1lbnQgPSBgJHt0aGlzLmVsZW1lbnR9ID4gJHt4LmVsZW1lbnR9YDtcclxuICAgICAgICAgICAgcmV0dXJuIHg7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgR2V0KG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBhID0gdGhpcy5fY2hpbGRyZW4uZmluZCh4ID0+IHgubmFtZSA9PT0gbmFtZSk7XHJcbiAgICAgICAgaWYgKCFhKSB0aHJvdyBuZXcgRXJyb3IoYE5vIGNoaWxkIG5hbWVkICR7bmFtZX1gKTtcclxuICAgICAgICByZXR1cm4gYTtcclxuICAgIH1cclxuICAgIGdldCBjaGlsZHJlbigpOiB7W2tleTogc3RyaW5nXTogVUlFbGVtZW50fSB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyh0aGlzLl9jaGlsZHJlbi5tYXAoeCA9PiBbeC5uYW1lLCB4XSkpXHJcbiAgICB9XHJcbn1cclxuLypleHBvcnQgY29uc3QgVUkgPSB7XHJcbiAgICBGb3JtOiB7XHJcbiAgICAgICAgX19jb21iaW5lOiBcIiN0cm9sbGJveF9mb3JtXCIsXHJcbiAgICAgICAgZ2V0IElucHV0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fX2NvbWJpbmV9ID4gdGV4dGFyZWEjdHJvbGxib3hfaW5wdXRgO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0IFNlbmRCdXR0b24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9fY29tYmluZX0gPiBidXR0b25gO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0IE5pY2tCdXR0b24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9fY29tYmluZX0gPiBidXR0b24jdHJvbGxib3hfbmlja19idG5gO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0IFVwbG9hZEJ1dHRvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX19jb21iaW5lfSA+IGJ1dHRvbiN0cm9sbGJveF91cGxvYWRfYnRuYDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0qL1xyXG5leHBvcnQgY29uc3QgVUkgPSB7XHJcbiAgICBGb3JtOiBuZXcgVUlFbGVtZW50KFwiRm9ybVwiLCBcIiN0cm9sbGJveF9mb3JtXCIpLlNldENoaWxkcmVuKFtcclxuICAgICAgICBuZXcgVUlFbGVtZW50KFwiSW5wdXRcIiwgXCJ0ZXh0YXJlYSN0cm9sbGJveF9pbnB1dFwiKSxcclxuICAgICAgICBuZXcgVUlFbGVtZW50KFwiU2VuZEJ1dHRvblwiLCBcImJ1dHRvblwiKSxcclxuICAgICAgICBuZXcgVUlFbGVtZW50KFwiTmlja0J1dHRvblwiLCBcImJ1dHRvbiN0cm9sbGJveF9uaWNrX2J0blwiKSxcclxuICAgICAgICBuZXcgVUlFbGVtZW50KFwiVXBsb2FkQnV0dG9uXCIsIFwiYnV0dG9uI3Ryb2xsYm94X3VwbG9hZF9idG5cIilcclxuXHJcbiAgICBdKVxyXG59XHJcbiIsImltcG9ydCB7IE1vZCB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RTdG9yYWdlIGV4dGVuZHMgTW9kIHtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIk1vZFN0b3JhZ2VcIjtcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nID0gXCJBIG1vZCB0aGF0IHN0b3JlcyBtb2QgZGF0YVwiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwic3RvcmFnZVwiO1xyXG4gICAgcHVibGljIGluaXQoKSB7fVxyXG4gICAgcHVibGljIEdldFN0b3JhZ2UobmFtZTogc3RyaW5nKTogU3RvcmFnZURhdGEge1xyXG4gICAgICAgIHJldHVybiBuZXcgU3RvcmFnZURhdGEobmFtZSk7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgU3RvcmFnZURhdGEge1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZykge31cclxuICAgIHB1YmxpYyBHZXQoa2V5OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgJHt0aGlzLm5hbWV9LyR7a2V5fWApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIFNldChrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke3RoaXMubmFtZX0vJHtrZXl9YCwgdmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIFJlbW92ZShrZXk6IHN0cmluZykge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGAke3RoaXMubmFtZX0vJHtrZXl9YCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgTGlzdCgpIHtcclxuICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGxvY2FsU3RvcmFnZSk7XHJcbiAgICAgICAgbGV0IG1vZHMgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGtleXNbaV0uc3RhcnRzV2l0aCh0aGlzLm5hbWUrXCIvXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RzLnB1c2goa2V5c1tpXS5yZXBsYWNlKGAke3RoaXMubmFtZX0vYCwgXCJcIikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtb2RzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIENsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuTGlzdCgpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgdGhpcy5SZW1vdmUoa2V5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IE1vZEFQSSwgTW9kLCBNb2RBUElfQyB9IGZyb20gXCIuL21vZGFwaVwiO1xyXG5pbXBvcnQgTUJMb2dnZXIgZnJvbSBcIi4vbWJsb2dnZXJcIjtcclxuaW1wb3J0IHJtdHJvbGxib3ggZnJvbSBcIi4vcm10cm9sbGJveFwiO1xyXG5pbXBvcnQgTW9kU3RvcmFnZSBmcm9tIFwiLi9tb2RzdG9yYWdlXCI7XHJcbmltcG9ydCBMb2FkZXJNb2QgZnJvbSBcIi4vbG9hZGVyLWpzXCI7XHJcblxyXG5jbGFzcyBNb2RMb2FkZXIgZXh0ZW5kcyBNb2Qge1xyXG4gICAgcHVibGljIG5hbWU6IHN0cmluZyA9IFwiTW9kIExvYWRlclwiO1xyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIkEgbW9kIHRoYXQgbG9hZHMgbW9kc1wiO1xyXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyA9IFwiMC4wLjFcIjtcclxuICAgIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZyA9IFwibW9kbG9hZGVyXCI7XHJcbiAgICBwcml2YXRlIGxvZ2dlciA9IE1vZEFQSS5HZXRNb2Q8TUJMb2dnZXI+KFwibWJsb2dnZXJcIikuQ3JlYXRlTG9nZ2VyKFwibW9kbG9hZGVyXCIpO1xyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgLyovL0B0cy1pZ25vcmVcclxuICAgICAgICB3aW5kb3cuTW9kQVBJID0gTW9kQVBJOyAvLyBleHBvc2UgdGhlIE1vZEFQSSB0byB0aGUgd2luZG93XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnTW9kQVBJIGV4cG9zZWQgdG8gd2luZG93Jyk7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93Lk1vZCA9IE1vZDtcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdNb2QgY2xhc3MgZXhwb3NlZCB0byB3aW5kb3cnKTsqL1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0xvYWRpbmcgbW9kcy4uLicpO1xyXG4gICAgICAgIGxldCBtb2RzID0gTW9kQVBJLkdldE1vZDxNb2RTdG9yYWdlPihcInN0b3JhZ2VcIikuR2V0U3RvcmFnZShcIm1vZHNcIilcclxuICAgICAgICBsZXQgbW9kTGlzdCA9IG1vZHMuTGlzdCgpO1xyXG4gICAgICAgIGxldCBtb2RUZXh0ID0gbW9kTGlzdC5tYXAoeCA9PiBtb2RzLkdldCh4KSk7XHJcbiAgICAgICAgbGV0IHByaW9yaXR5TW9kczogbnVtYmVyW10gPSBbXTtcclxuICAgICAgICBtb2RUZXh0LmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnLy9AbW9kbG9hZGVyLXByaW9yaXR5JykpIHtcclxuICAgICAgICAgICAgICAgIHByaW9yaXR5TW9kcy5wdXNoKGluZGV4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRm91bmQgJHttb2RzLkxpc3QoKS5sZW5ndGh9IG1vZHNgKTtcclxuICAgICAgICBmb3IgKGxldCBpbmRleCBvZiBwcmlvcml0eU1vZHMpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGluZyBwcmlvcml0aXplZCBtb2QgJHttb2RMaXN0W2luZGV4XX1gKTtcclxuICAgICAgICAgICAgTW9kQVBJLkxvYWRNb2QobW9kTGlzdFtpbmRleF0pO1xyXG4gICAgICAgICAgICBtb2RMaXN0LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbW9kcy5MaXN0KCkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IG1vZE5hbWUgPSBtb2RzLkxpc3QoKVtpXVxyXG4gICAgICAgICAgICBsZXQgbW9kID0gbW9kcy5HZXQobW9kTmFtZSlcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGluZyAke21vZH1gKTtcclxuICAgICAgICAgICAgbGV0IGxvYWRlcnMgPSBNb2RBUEkuRmlsdGVyTW9kczxMb2FkZXJNb2Q+KFwibG9hZGVyLVwiKTtcclxuICAgICAgICAgICAgbGV0IGxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBsb2FkZXIgb2YgbG9hZGVycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvYWRlci5DYW5Mb2FkKG1vZE5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGluZyBtb2QgJHttb2R9IHdpdGggbG9hZGVyICR7bG9hZGVyLm5hbWV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgTW9kQVBJLkxvYWRNb2QobG9hZGVyLkxvYWQobW9kKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTG9hZGVkICR7bW9kfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFsb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBDb3VsZCBub3QgbG9hZCBtb2QgJHttb2ROYW1lfTogbm8gbG9hZGVyIGZvdW5kIGZvciBpdGApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYCR7TW9kQVBJLkdldE1vZHMoKS5sZW5ndGh9IE1vZHMgbG9hZGVkYCk7XHJcbiAgICB9XHJcbn1cclxuTW9kQVBJLkxvYWRNb2QoTUJMb2dnZXIpO1xyXG5Nb2RBUEkuTG9hZE1vZChybXRyb2xsYm94KTtcclxuTW9kQVBJLkxvYWRNb2QoTW9kU3RvcmFnZSk7XHJcbk1vZEFQSS5Mb2FkTW9kKExvYWRlck1vZCk7XHJcbk1vZEFQSS5Mb2FkTW9kKE1vZExvYWRlcik7XHJcblxyXG5leHBvcnQgeyBNb2QsIE1vZEFQSSwgTW9kQVBJX0MgfTsiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwic2VsZiIsIkxvYWRlck1vZCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInZlcnNpb24iLCJuYW1lc3BhY2UiLCJMb2FkIiwiZGF0YSIsImV2YWwiLCJDYW5Mb2FkIiwiZmlsZSIsImVuZHNXaXRoIiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiX2NhbGxiYWNrcyIsIm9uIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJwdXNoIiwib2ZmIiwiZm9yRWFjaCIsInZhbHVlIiwiaW5kZXgiLCJzcGxpY2UiLCJvbmNlIiwiZCIsImFyZ3VtZW50cyIsImNhbGxlZSIsImVtaXQiLCJhcmdzIiwieCIsIkV2ZW50IiwiZGVmYXVsdGFjdGlvbiIsImRlZmF1bHRQcmV2ZW50ZWQiLCJwcmV2ZW50RGVmYXVsdCIsInJ1bl9kZWZhdWx0IiwiYXJyYXkiLCJvYmplY3QiLCJkZWVwQ2xvbmUiLCJhcnIiLCJuZXdhcnIiLCJpIiwibGVuZ3RoIiwiQXJyYXkiLCJpc0FycmF5IiwicmVtb3ZlIiwiaGFzRnVuY3Rpb25zIiwib2JqIiwiaXRlbSIsIndpbmRvdyIsInN0cnVjdHVyZWRDbG9uZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIm5ld29iaiIsIndpbm8iLCJNb2QiLCJpbml0IiwiTW9kQVBJX0MiLCJsb2FkZWQiLCJob29rcyIsIkdldE1vZCIsImEiLCJmaW5kIiwiRXJyb3IiLCJHZXRNb2RCeU5hbWUiLCJHZXRNb2RzIiwiTG9hZE1vZCIsIm1vZCIsImxtb2QiLCJSZXBsYWNlTW9kIiwibmV3bW9kIiwiZmluZEluZGV4IiwiSG9vayIsImZ1bmN0aW9uX25hbWUiLCJldmVtIiwib2dmdW5jIiwiZmFyZ3MiLCJuYXJncyIsImZldmVudCIsImZ1bmNhcmdzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiYmluZCIsIkZpbHRlck1vZHMiLCJwcmVmaXgiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiTW9kQVBJIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsIk1CTG9nZ2VyIiwiQ3JlYXRlTG9nZ2VyIiwiTG9nZ2VyIiwiZ2V0VGltZSIsIkRhdGUiLCJnZXRIb3VycyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsImxvZyIsImNvbnNvbGUiLCJpbmZvIiwid2FybiIsImVycm9yIiwicm10cm9sbGJveCIsImxvZ2dlciIsInJlZ2lzdGVyZWRDb21tYW5kcyIsImV2IiwibXNnIiwic3Vic3RyIiwic3BsaXQiLCJjbWQiLCJzaGlmdCIsImluY2x1ZGVzIiwiY21kcyIsImMiLCJhbGlhc2VzIiwiZXhlY3V0ZSIsIlByaW50TWVzc2FnZSIsInByaW50TXNnIiwiUmVnaXN0ZXJDb21tYW5kIiwiR2V0RWxlbWVudCIsInVpZWxlbWVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIkdldFNlbGVjdG9yIiwiT3BlblBvcHVwIiwiaHRtbCIsInBvcHVwIiwiVUlFbGVtZW50IiwiZWxlbWVudCIsIl9jaGlsZHJlbiIsIlNldENoaWxkcmVuIiwiY2hpbGRzIiwibWFwIiwiR2V0IiwiY2hpbGRyZW4iLCJmcm9tRW50cmllcyIsIk1vZFN0b3JhZ2UiLCJHZXRTdG9yYWdlIiwiU3RvcmFnZURhdGEiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiU2V0Iiwic2V0SXRlbSIsIlJlbW92ZSIsInJlbW92ZUl0ZW0iLCJMaXN0Iiwia2V5cyIsIm1vZHMiLCJyZXBsYWNlIiwiQ2xlYXIiLCJNb2RMb2FkZXIiLCJtb2RMaXN0IiwibW9kVGV4dCIsInByaW9yaXR5TW9kcyIsIm1vZE5hbWUiLCJsb2FkZXJzIiwibG9hZGVyIl0sInNvdXJjZVJvb3QiOiIifQ==